Compiling Program: C:\DataFlex Projects\ColegioAppWeb\AppSrc\WebApp.src
Memory Available: 16006377472
1>Use AllWebAppClasses.pkg
Using pre-compiled package ALLWEBAPPCLASSES.PKG
Including file: AllWebAppClasses.x64.pkd    (C:\Program Files\DataFlex 24.0\Pkg\AllWebAppClasses.x64.pkd)
36015>Use cConnection.pkg
36015>Use cWebMenuItem.pkg
36015>
36015>Object oApplication is a cApplication
36017>    Object oConnection is a cConnection
36019>        Use LoginEncryption.pkg
Including file: LoginEncryption.pkg    (C:\Program Files\DataFlex 24.0\Pkg\LoginEncryption.pkg)
36019>>>Use cLoginEncryption.pkg
Including file: cLoginEncryption.pkg    (C:\Program Files\DataFlex 24.0\Pkg\cLoginEncryption.pkg)
36019>>>>>Use cCryptographerEx.pkg
36019>>>>>
36019>>>>>Class cLoginEncryption is a cObject
36020>>>>>    
36020>>>>>    Procedure Construct_Object
36022>>>>>        Forward Send Construct_Object
36024>>>>>        // this must be set to a multi (40ish) character random key
36024>>>>>        Property String psEncryptPassword ""
36025>>>>>        
36025>>>>>        Object oDataCrypter is a cCryptographerEx
36027>>>>>            Set piHash to CALG_SHA_256
36028>>>>>            Set piCipher to CALG_AES_256
36029>>>>>            Set psProvider to "" //  Not providing a specific provider gives the default provider for the provider type
36030>>>>>            Set piProvider to PROV_RSA_AES
36031>>>>>        End_Object
36032>>>>>    End_Procedure
36033>>>>>    
36033>>>>>    // This can be augmented to return a password encryption key using any
36033>>>>>    // hidden mechanism desired.
36033>>>>>    Function GetEncryptionPassword Returns String
36035>>>>>        String sPassword
36035>>>>>        Get psEncryptPassword to sPassword
36036>>>>>        Function_Return sPassword
36037>>>>>    End_Function
36038>>>>>    
36038>>>>>    // Encrypts a string into an unreadable hash that can later be decrypted using DecryptKey.
36038>>>>>    //
36038>>>>>    // Params:
36038>>>>>    //   sPlainText     String to encrypt.
36038>>>>>    // Returns:
36038>>>>>    //   Base64 encoded hash.
36038>>>>>    Function EncryptPassword String sPlainText Returns String
36040>>>>>        String sEncryptPassword sBase64
36040>>>>>        UChar[] ucBinary
36041>>>>>        Pointer pBase64
36041>>>>>        Integer iVoid
36041>>>>>        
36041>>>>>        //  Encrypt Key
36041>>>>>        Get GetEncryptionPassword to sEncryptPassword
36042>>>>>        If (sEncryptPassword = "") Begin
36044>>>>>            Error DFERR_PROGRAM "No encryption password set"
36045>>>>>>
36045>>>>>        End
36045>>>>>>
36045>>>>>        
36045>>>>>        Get Encrypt of oDataCrypter (StringToUCharArray(sEncryptPassword)) (StringToUCharArray(sPlainText)) to ucBinary
36046>>>>>        
36046>>>>>        If (SizeOfArray(ucBinary) = 0) Begin
36048>>>>>            Error DFERR_PROGRAM "Unable to encrypt database login password"
36049>>>>>>
36049>>>>>            Function_Return ""
36050>>>>>        End
36050>>>>>>
36050>>>>>        
36050>>>>>        //  Encode binary hash to Base64
36050>>>>>        Move (Base64Encode(AddressOf(ucBinary), SizeOfArray(ucBinary))) to pBase64
36051>>>>>        Move (PointerToString(pBase64)) to sBase64
36052>>>>>        Move (Free(pBase64)) to iVoid
36053>>>>>        
36053>>>>>        Function_Return sBase64
36054>>>>>    End_Function
36055>>>>>    
36055>>>>>    
36055>>>>>    // Decrypts the unreadable hash generated by EncryptKey into a readable string.
36055>>>>>    //
36055>>>>>    // Params:
36055>>>>>    //   sBase64EncryptedPassword       Base64 Encrypted password
36055>>>>>    // Returns:
36055>>>>>    //   Readable plain text password
36055>>>>>    Function DecryptPassword String sBase64EncryptedPassword Returns String
36057>>>>>        String sEncryptPassword
36057>>>>>        UChar[] ucBinary ucPlain
36059>>>>>        Boolean bIsHex
36059>>>>>        Integer iLen iVoid
36059>>>>>        Pointer pBinary
36059>>>>>        
36059>>>>>        If (sBase64EncryptedPassword <> "") Begin
36061>>>>>            //  Decode from Base64
36061>>>>>            Move (Base64Decode(AddressOf(sBase64EncryptedPassword), &iLen)) to pBinary
36062>>>>>            
36062>>>>>            Move (ResizeArray(ucBinary, iLen, 0)) to ucBinary
36063>>>>>            Move (MemCopy(AddressOf(ucBinary), pBinary, iLen)) to iVoid
36064>>>>>                        
36064>>>>>            Move (Free(pBinary)) to iVoid
36065>>>>>            
36065>>>>>            //  Encrypted binary hash to string
36065>>>>>            Get GetEncryptionPassword to sEncryptPassword
36066>>>>>            Get Decrypt of oDataCrypter (StringToUCharArray(sEncryptPassword)) ucBinary to ucPlain
36067>>>>>        End
36067>>>>>>
36067>>>>>        
36067>>>>>        Function_Return (UCharArrayToString(ucPlain))
36068>>>>>    End_Function
36069>>>>>End_Class
36070>>>
36070>>>Object oLoginEncryption is a cLoginEncryption
36072>>>
36072>>>    // this must be created in your appsrc directory and must contain an encryption
36072>>>    // key that is set to psEncryptPassword. It will look something like this
36072>>>    //
36072>>>    // Set psEncryptPassword to "JchUAo7W@r.b{<Yk~OONi0nq=sMi[*Rn[A-`Vo)q"
36072>>>    //  
Including file: LoginEncryptionKey.inc    (C:\DataFlex Projects\ColegioAppWeb\AppSrc\LoginEncryptionKey.inc)
36072>>>>// Studio generated login encryption key
36072>>>>Set psEncryptPassword to "l0#+3%h0Gfb*z}g.2beO1A.4X~j(p@AB%<{=Rgi3"
36073>>>>
36073>>>    
36073>>>    // use this to register this object to your cConnection Object. This object
36073>>>    // must be created after the cConnection object
36073>>>    Move Self to ghoLoginEncryption
36074>>>End_Object
36075>    End_Object
36076>End_Object
36077>
36077>Object oWebApp is a cWebApp
36079>    Set psTheme to "Df_Material"
36080>    Set peAlignView to alignCenter
36081>    
36081>    // It is important to set this so that all views will default
36081>    // to drill down style views.
36081>    Set peApplicationStyle to wvsDrillDown   
36082>    Set peApplicationStateMode to asmHistoryAndUrls 
36083>    Set psEncryptPassword to "tm<W]8a2xu$eEiKo6To#(dY~P0&#as*~_%sXO,xT"
36084>    Set peLoginMode to lmLoginNone
36085>
36085>    Object oViewStack is a cWebViewStack
36087>    End_Object
36088>    
36088>    Procedure HideHeader
36091>        WebSet pbRender of oHeaderPanel to False
36092>    End_Procedure
36093>
36093>    Procedure ShowHeader
36096>        WebSet pbRender of oHeaderPanel to True 
36097>    End_Procedure
36098>
36098>    Object oHeaderPanel is a cWebPanel
36100>        Set peRegion to prTop
36101>        Set psCSSClass to "HeaderPanel"
36102>        
36102>        Object oMenuPanel is a cWebPanel
36104>            Set peRegion to prLeft
36105>            Set piWidth to 50
36106>            
36106>            Object oMenuButton is a cWebMenuButton
36108>                Set piMenuHeight to 500
36109>
36109>                Object oDashboard_itm is a cWebMenuItem
36111>                    Set psCaption to "Seleccione"
36112>                    
36112>                    WebRegisterPath ntNavigateBegin oDashboard
36118>
36118>                    Procedure OnClick
36121>                        Send NavigatePath
36122>                    End_Procedure
36123>                End_Object
36124>
36124>                Object oViewMenu is a cWebMenuItem
36126>                    Set psCaption to "Listados"
36127>
36127>                    Object oSchoolHouseItem1 is a cWebMenuItem
36129>                        Set psCaption to "Listado de COLEGIOS"
36130>
36130>                        WebRegisterPath ntNavigateBegin oSelectSchoolHouse
36136>
36136>                        Procedure OnClick
36139>                            Forward Send OnClick
36141>                                Send NavigatePath
36142>                        End_Procedure
36143>                    End_Object
36144>
36144>                    Object oSelectStudentItem1 is a cWebMenuItem
36146>                        Set psCaption to "Listado de ESTUDIANTES"
36147>
36147>                        WebRegisterPath ntNavigateBegin oSelectStudent
36153>
36153>                        Procedure OnClick
36156>                            Forward Send OnClick
36158>                                Send NavigatePath
36159>                        End_Procedure
36160>                    End_Object
36161>                End_Object
36162>
36162>                Object oSignOut_itm is a cWebMenuItem
36164>                    Set psCaption to "Salir"
36165>
36165>                    Procedure OnClick
36168>                        Send RequestLogOut of ghoWebSessionManager
36169>                    End_Procedure
36170>                End_Object
36171>            End_Object  
36172>
36172>            Object oBackButton is a cWebButton
36174>                Set psCSSClass to "WebBack_Icon"
36175>                Set pbRender to False
36176>                
36176>                Procedure OnClick
36179>                    Handle hoTop
36179>                    
36179>                    Get TopViewHandle of oViewStack to hoTop
36180>                    If (hoTop > 0) Begin
36182>                        Send NavigateCancel of hoTop 
36183>                    End
36183>                End_Procedure
36184>            End_Object
36185>            
36185>            Send AddClient of oViewStack Self
36186>                
36186>            Procedure OnUpdateViewStack
36189>                Handle hoTop hoDflt
36189>                Integer eMode
36189>                Boolean bTop
36189>                
36189>                WebGet peMode of (Owner(Self)) to eMode
36190>                
36190>                Get TopViewHandle of oViewStack to hoTop
36191>                Get GetDefaultView to hoDflt
36192>                Move (hoTop=0 or hoTop=hoDflt) to bTop
36193>                
36193>                WebSet pbRender of oBackButton to (not(bTop) and eMode >= rmMobile)
36194>                WebSet pbRender of oMenuButton to (bTop or eMode < rmMobile)
36195>            End_Procedure
36196>
36196>        End_Object
36197>
36197>        Object oCaptionPanel is a cWebPanel
36199>            Set piColumnCount to 12
36200>
36200>            Object oCaptionBreadcrumb is a cWebBreadcrumb
36202>                Set peBreadcrumbStyle to crumbCaption
36203>                WebSetResponsive peBreadcrumbStyle rmMobile to crumbDropDown
36204>            End_Object         
36205>        End_Object
36206>        
36206>        Object oActionPanel is a cWebPanel
36208>            Set peRegion to prRight
36209>            Set piColumnCount to 1
36210>            Set piWidth to 120
36211>
36211>            Object oMainActions is a cWebActionBar
36213>                Set psGroupName to "MainActions"
36214>
36214>                Set piColumnSpan to 0
36215>                Set peAlign to alignRight
36216>            End_Object
36217>        End_Object
36218>
36218>        Object oBreadcrumbPanel is a cWebPanel
36220>            Set peRegion to prBottom
36221>            
36221>            Object oHorizontalBreadcrumb is a cWebBreadcrumb
36223>                WebSetResponsive pbRender rmMobile to False
36224>            End_Object         
36225>        End_Object
36226>
36226>    End_Object    
36227>
36227>    Use SessionManager.wo
Including file: SessionManager.wo    (C:\DataFlex Projects\ColegioAppWeb\AppSrc\SessionManager.wo)
36227>>>Use cWebSessionManagerStandard.pkg
Including file: cWebSessionManagerStandard.pkg    (C:\Program Files\DataFlex 24.0\Pkg\cWebSessionManagerStandard.pkg)
36227>>>>>Use cWebSessionManager.pkg
36227>>>>>Use cWebAppSessionDataDictionary.dd
Including file: cWebAppSessionDataDictionary.dd    (C:\Program Files\DataFlex 24.0\Pkg\cWebAppSessionDataDictionary.dd)
36227>>>>>>>Use DataDict.pkg
36227>>>>>>>
36227>>>>>>>Open WebAppSession
Including file: WebAppSession.fd    (C:\DataFlex Projects\ColegioAppWeb\DDSrc\WebAppSession.fd)
36229>>>>>>>Open WebAppUser
Including file: WebAppUser.fd    (C:\DataFlex Projects\ColegioAppWeb\DDSrc\WebAppUser.fd)
36231>>>>>>>
36231>>>>>>>Class cWebAppSessionDataDictionary is a DataDictionary
36232>>>>>>>    Procedure Construct_Object
36234>>>>>>>        Forward Send Construct_Object
36236>>>>>>>
36236>>>>>>>        Set Main_File to WebAppSession.File_Number
36237>>>>>>>
36237>>>>>>>        Set Add_Server_File to WebAppUser.File_Number
36238>>>>>>>
36238>>>>>>>        Set ParentNullAllowed WebAppUser.File_Number to True
36239>>>>>>>
36239>>>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_NOPUT to True
36240>>>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_FINDREQ to True
36241>>>>>>>        Set Foreign_Field_Option DD_INDEXFIELD DD_NOPUT to True
36242>>>>>>>        Set Foreign_Field_Option DD_DEFAULT DD_DISPLAYONLY to True
36243>>>>>>>
36243>>>>>>>        Set Field_Checkbox_Values Field WebAppSession.Active to "Y" "N"
36244>>>>>>>        Set Field_Error Field WebAppSession.Active to 500 "Invalid WebAppSession Active State"
36245>>>>>>>    End_Procedure
36246>>>>>>>
36246>>>>>>>    Procedure Creating
36248>>>>>>>        DateTime dtCurrentDateTime
36248>>>>>>>        
36248>>>>>>>        Forward Send Creating
36250>>>>>>>        
36250>>>>>>>        //  Init usecounter
36250>>>>>>>        Move 0 to WebAppSession.UseCount
36251>>>>>>>        
36251>>>>>>>        //  Set the creation and access time to the current time
36251>>>>>>>        Move (CurrentDateTime()) to dtCurrentDateTime
36252>>>>>>>    
36252>>>>>>>        Get TimeToString dtCurrentDateTime to WebAppSession.CreateTime
36253>>>>>>>        Get TimeToString dtCurrentDateTime to WebAppSession.LastAccessTime
36254>>>>>>>        
36254>>>>>>>        Move dtCurrentDateTime to WebAppSession.CreateDate
36255>>>>>>>        Move dtCurrentDateTime to WebAppSession.LastAccessDate
36256>>>>>>>    End_Procedure
36257>>>>>>>    
36257>>>>>>>    //
36257>>>>>>>    //  Converts the given time to an string that can be saved in the database.
36257>>>>>>>    //
36257>>>>>>>    //  Params:
36257>>>>>>>    //      dtTime  Time to convert
36257>>>>>>>    //  Returns:
36257>>>>>>>    //      String with "HH:MM:SS" format
36257>>>>>>>    //
36257>>>>>>>    Function TimeToString DateTime dtTime Returns String
36259>>>>>>>        String sHours sMinutes sSeconds
36259>>>>>>>        
36259>>>>>>>        //  Extract parts
36259>>>>>>>        Move (String(DateGetHour(dtTime))) to sHours
36260>>>>>>>        Move (String(DateGetMinute(dtTime))) to sMinutes
36261>>>>>>>        Move (String(DateGetSecond(dtTime))) to sSeconds
36262>>>>>>>        
36262>>>>>>>        //  Fill out with 0
36262>>>>>>>        If (Length(sHours) = 1) ;            Move ("0" + sHours) to sHours
36265>>>>>>>        If (Length(sMinutes) = 1) ;            Move ("0" + sMinutes) to sMinutes
36268>>>>>>>        If (Length(sSeconds) = 1) ;            Move ("0" + sSeconds) to sSeconds
36271>>>>>>>        
36271>>>>>>>        Function_Return (sHours + ":" + sMinutes + ":" + sSeconds)
36272>>>>>>>    End_Function
36273>>>>>>>    
36273>>>>>>>    //
36273>>>>>>>    //  Sets the time of the datetime variable to the time in the string.
36273>>>>>>>    //
36273>>>>>>>    //  Params:
36273>>>>>>>    //      dtTime  Datetime variable to add time to
36273>>>>>>>    //      sTimeString String with time in the format "HH:MM:SS"
36273>>>>>>>    //  Returns:
36273>>>>>>>    //      dtDateTime with the loaded time
36273>>>>>>>    //
36273>>>>>>>    Function StringToTime DateTime dtTime String sTimeString Returns DateTime
36275>>>>>>>        String sHours sMinutes sSeconds
36275>>>>>>>        
36275>>>>>>>        //  Extract parts
36275>>>>>>>        Move (Mid(sTimeString, 2, 1)) to sHours
36276>>>>>>>        Move (Mid(sTimeString, 2, 4)) to sMinutes
36277>>>>>>>        Move (Mid(sTimeString, 2, 7)) to sSeconds
36278>>>>>>>        
36278>>>>>>>        //  Set to DateTime
36278>>>>>>>        Move (DateSetHour(dtTime, (Integer(sHours)))) to dtTime
36279>>>>>>>        Move (DateSetMinute(dtTime, (Integer(sMinutes)))) to dtTime
36280>>>>>>>        Move (DateSetSecond(dtTime, (Integer(sSeconds)))) to dtTime
36281>>>>>>>        
36281>>>>>>>        Function_Return dtTime
36282>>>>>>>    End_Function
36283>>>>>>>End_Class
36284>>>>>Use cWebAppUserDataDictionary.dd
Including file: cWebAppUserDataDictionary.dd    (C:\Program Files\DataFlex 24.0\Pkg\cWebAppUserDataDictionary.dd)
36284>>>>>>>Use DataDict.pkg
36284>>>>>>>Open WebAppUser
36286>>>>>>>Open WebAppSession
36288>>>>>>>
36288>>>>>>>Class cWebAppUserDataDictionary is a DataDictionary
36289>>>>>>>    
36289>>>>>>>    Procedure Construct_Object
36291>>>>>>>        Forward Send Construct_Object
36293>>>>>>>        Set Main_File to WebAppUser.File_Number
36294>>>>>>>
36294>>>>>>>        Set Add_Client_File to WebAppSession.File_Number
36295>>>>>>>
36295>>>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_NOPUT to True
36296>>>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_FINDREQ to True
36297>>>>>>>        Set Foreign_Field_Option DD_INDEXFIELD DD_NOPUT to True
36298>>>>>>>        Set Foreign_Field_Option DD_DEFAULT DD_DISPLAYONLY to True
36299>>>>>>>    End_Procedure
36300>>>>>>>
36300>>>>>>>End_Class
36301>>>>>
36301>>>>>Class cWebSessionManagerStandard is a cWebSessionManager
36302>>>>>    
36302>>>>>    Procedure Construct_Object
36304>>>>>        Handle hoUserDD hoSessionDD
36304>>>>>        
36304>>>>>        Forward Send Construct_Object
36306>>>>>        
36306>>>>>        Property Handle phoUserDD 0      // Handle to the WebAppUser DDO
36307>>>>>        Property Handle phoSessionDD 0   // Handle to the WebAppSession DDO        
36308>>>>>        
36308>>>>>        Get Create (RefClass(cWebAppUserDataDictionary)) to hoUserDD
36309>>>>>        Get Create (RefClass(cWebAppSessionDataDictionary)) to hoSessionDD
36310>>>>>        Set DDO_Server of hoSessionDD to hoUserDD
36311>>>>>
36311>>>>>        Set phoUserDD to hoUserDD
36312>>>>>        Set phoSessionDD to hoSessionDD
36313>>>>>        Property Boolean pbCreatingNewSession False
36314>>>>>        Property String psLoginName
36315>>>>>        Property String psUserName ""
36316>>>>>        Property Integer piUserRights 0
36317>>>>>    End_Procedure
36318>>>>>    
36318>>>>>    Function CreateSession String sRemoteAddress Returns String
36320>>>>>        String sSessionKey
36320>>>>>        Integer iErr
36320>>>>>        Boolean bLogWebSession
36320>>>>>        Handle hoSessionDD       
36320>>>>>        Get phoSessionDD to hoSessionDD
36321>>>>>        
36321>>>>>        //  Get session key
36321>>>>>        Forward Get CreateSession sRemoteAddress to sSessionKey
36323>>>>>        
36323>>>>>        Get pbLogWebSession to bLogWebSession
36324>>>>>        If not bLogWebSession Begin
36326>>>>>            Function_Return sSessionKey        
36327>>>>>        End
36327>>>>>>
36327>>>>>
36327>>>>>        //  Store session
36327>>>>>        Send Clear of hoSessionDD
36328>>>>>        Set Field_Changed_Value of hoSessionDD Field WebAppSession.SessionKey to sSessionKey
36329>>>>>        Set Field_Changed_Value of hoSessionDD Field WebAppSession.RemoteAddress to sRemoteAddress
36330>>>>>        Set Field_Changed_Value of hoSessionDD Field WebAppSession.Active to "Y"
36331>>>>>        Get Request_Validate of hoSessionDD to iErr
36332>>>>>        If (iErr) Begin
36334>>>>>            // this should not happen. If it does its a programming error
36334>>>>>            Error DFERR_PROGRAM C_$WebAppSesionValidateFailed
36335>>>>>>
36335>>>>>            Function_Return ""
36336>>>>>        End
36336>>>>>>
36336>>>>>        Send Request_Save of hoSessionDD
36337>>>>>        If (Err) Begin
36339>>>>>            // this shouldn't happen, if it does likely a duplicate session key issue, even through request_save already gave an error we give another one to make tracking down easier
36339>>>>>            Error DFERR_PROGRAM C_$WebAppSesionSaveFailed
36340>>>>>>
36340>>>>>            Function_Return ""
36341>>>>>        End
36341>>>>>>
36341>>>>>       
36341>>>>>        Function_Return sSessionKey        
36342>>>>>    End_Function
36343>>>>>    
36343>>>>>    
36343>>>>>    Function ValidateSession String sSessionKey Boolean bOptLoadWebApp Returns Boolean
36345>>>>>        DateTime dtLastAccess dtCurrent
36345>>>>>        TimeSpan tsDiff
36345>>>>>        Integer iErr iSessionTimeout iSpanMinutes
36345>>>>>        Boolean bResult bCreatingNewSession
36345>>>>>        Boolean bLogWebSession bLoadWebApp
36345>>>>>        Integer eLoginMode
36345>>>>>        String sTime
36345>>>>>        Handle hoSessionDD hoUserDD       
36345>>>>>        
36345>>>>>        Move False to bLoadWebApp
36346>>>>>        If (num_arguments >= 2) Begin
36348>>>>>            Move bOptLoadWebApp to bLoadWebApp
36349>>>>>        End
36349>>>>>>
36349>>>>>        
36349>>>>>        Get phoSessionDD to hoSessionDD
36350>>>>>        Get phoUserDD to hoUserDD
36351>>>>>        
36351>>>>>        Get pbLogWebSession to bLogWebSession
36352>>>>>        Get peLoginMode to eLoginMode
36353>>>>>        
36353>>>>>        // for this object, you can only disable logging if login completely is disabled
36353>>>>>        If (not(bLogWebSession) and (eLoginMode<>lmLoginNone)) Begin
36355>>>>>            Error DFERR_PROGRAM C_$WebSessionLoggingMustBeEnabled
36356>>>>>>
36356>>>>>            Function_Return False
36357>>>>>        End
36357>>>>>>
36357>>>>>
36357>>>>>        //  Clear session properties
36357>>>>>        Set psSessionKey to ""
36358>>>>>        Send UpdateSessionProperties True
36359>>>>>        
36359>>>>>        If not bLogWebSession Begin
36361>>>>>            Forward Get ValidateSession sSessionKey to bResult
36363>>>>>            Function_Return bResult
36364>>>>>        End        
36364>>>>>>
36364>>>>>        
36364>>>>>        Move False to bResult
36365>>>>>        Get piSessionTimeout to iSessionTimeout 
36366>>>>>        
36366>>>>>        //  Check if session exists
36366>>>>>        Send Clear of hoSessionDD
36367>>>>>        Move sSessionKey to WebAppSession.SessionKey
36368>>>>>        Send Find of hoSessionDD EQ Index.1
36369>>>>>            
36369>>>>>        If (Found) Begin
36371>>>>>            //  Calculate timespan between now and last access time
36371>>>>>            Move (CurrentDateTime()) to dtCurrent
36372>>>>>            Move WebAppSession.LastAccessDate to dtLastAccess
36373>>>>>            Get StringToTime of hoSessionDD dtLastAccess WebAppSession.LastAccessTime to dtLastAccess
36374>>>>>            Move (dtCurrent - dtLastAccess) to tsDiff
36375>>>>>            Move (SpanTotalMinutes(tsDiff)) to iSpanMinutes
36376>>>>>            
36376>>>>>            //  Check if session didn't time out
36376>>>>>            If (IsDateValid(dtLastAccess) and (iSessionTimeout <= 0 or (iSpanMinutes < iSessionTimeout)) and WebAppSession.Active = "Y") Begin
36378>>>>>                Forward Get ValidateSession sSessionKey to bResult
36380>>>>>                   
36380>>>>>                If (bResult) Begin
36382>>>>>                    //  Update session record
36382>>>>>                    Get TimeToString of hoSessionDD dtCurrent to sTime 
36383>>>>>                    Set Field_Changed_Value of hoSessionDD Field WebAppSession.LastAccessDate to dtCurrent
36384>>>>>                    Set Field_Changed_Value of hoSessionDD Field WebAppSession.LastAccessTime to sTime
36385>>>>>                    Set Field_Changed_Value of hoSessionDD Field WebAppSession.UseCount to (WebAppSession.UseCount + 1)
36386>>>>>                    Get Request_Validate of hoSessionDD to iErr
36387>>>>>                    If (iErr) Begin
36389>>>>>                        // this should not happen. If it does its a programming error
36389>>>>>                        Error DFERR_PROGRAM C_$WebAppSesionValidateFailed
36390>>>>>>
36390>>>>>                        Function_Return False
36391>>>>>                    End
36391>>>>>>
36391>>>>>                    Send Request_Save of hoSessionDD
36392>>>>>                    
36392>>>>>                    //  Update user properties
36392>>>>>                    Send UpdateSessionProperties False
36393>>>>>                End
36393>>>>>>
36393>>>>>            End
36393>>>>>>
36393>>>>>            Else Begin
36394>>>>>                // Test the Creating New Session Flag to protect against infinite recursion....
36394>>>>>                Get pbCreatingNewSession to bCreatingNewSession
36395>>>>>                
36395>>>>>                If (not(bCreatingNewSession)) Begin
36397>>>>>                    If (not(bLoadWebApp)) Begin
36399>>>>>                        Move False to bResult   //  We can only continue immediately if we were loading the webapp, other operations are not allowed!
36400>>>>>                        Error DFERR_WEBAPP_SESSION_TIMEOUT "Your application session has timed out or is inactive, please login again."
36401>>>>>>
36401>>>>>                        Send NavigateRefresh of ghoWebApp          // refresh the WebApp at the client (triggers a login)
36402>>>>>                    End
36402>>>>>>
36402>>>>>                    Else Begin
36403>>>>>                        Set pbCreatingNewSession to True                    
36404>>>>>                        Get RecreateSession of ghoWebApp to bResult 
36405>>>>>                        Set pbCreatingNewSession to False                        
36406>>>>>                    End
36406>>>>>>
36406>>>>>                End
36406>>>>>>
36406>>>>>            End
36406>>>>>>
36406>>>>>        End
36406>>>>>>
36406>>>>>        Else Begin
36407>>>>>            Error DFERR_WEBAPP_BAD_SESSION_KEY "Session key not known (reload page to recreate session)"
36408>>>>>>
36408>>>>>        End
36408>>>>>>
36408>>>>>        
36408>>>>>        Function_Return bResult
36409>>>>>    End_Function
36410>>>>>    
36410>>>>>    Function UserLogin String sLoginName String sPassword Returns Boolean
36412>>>>>        String sSessionKey sUserPassword
36412>>>>>        Handle hoSessionDD hoUserDD
36412>>>>>        Boolean bMatch  
36412>>>>>        
36412>>>>>        Get phoSessionDD to hoSessionDD
36413>>>>>        Get phoUserDD to hoUserDD
36414>>>>>        Integer iErr eLoginMode
36414>>>>>        
36414>>>>>        // Refind session record
36414>>>>>        Get psSessionKey to sSessionKey
36415>>>>>        Send Clear of hoSessionDD
36416>>>>>        Move sSessionKey to WebAppSession.SessionKey
36417>>>>>        Send Find of hoSessionDD EQ Index.1
36418>>>>>        
36418>>>>>        If (Found and WebAppSession.SessionKey = sSessionKey) Begin
36420>>>>>            Get peLoginMode to eLoginMode
36421>>>>>            
36421>>>>>            //  Find the user
36421>>>>>            Move sLoginName to WebAppUser.LoginName
36422>>>>>            Send Find of hoUserDD EQ Index.1
36423>>>>>            
36423>>>>>            // Check username and password
36423>>>>>            If (Found and (Lowercase(sLoginName) = Lowercase(Trim(WebAppUser.LoginName)))) Begin
36425>>>>>                Get Field_Current_Value of hoUserDD Field WebAppUser.Password to sUserPassword
36426>>>>>                Get ComparePasswords (Trim(sUserPassword)) (Trim(sPassword)) to bMatch
36427>>>>>                
36427>>>>>                If (bMatch) Begin
36429>>>>>                    // Store the login
36429>>>>>                    Set Field_Changed_Value of hoUserDD Field WebAppUser.LastLogin to (CurrentDateTime())
36430>>>>>                    Get Request_Validate of hoSessionDD to iErr
36431>>>>>                    If (iErr) Begin
36433>>>>>                        // this should not happen. If it does its a programming error
36433>>>>>                        Error DFERR_PROGRAM C_$WebAppSesionValidateFailed
36434>>>>>>
36434>>>>>                        Function_Return False
36435>>>>>                    End
36435>>>>>>
36435>>>>>                    
36435>>>>>                    Send Request_Save of hoSessionDD
36436>>>>>                    
36436>>>>>                    // Update session properties
36436>>>>>                    Send UpdateSessionProperties False
36437>>>>>                    Send NotifyChangeRights
36438>>>>>                    Function_Return True
36439>>>>>                End
36439>>>>>>
36439>>>>>                Else Begin
36440>>>>>                    //  We should rely directly on this buffer elsewhere but just be sure
36440>>>>>                    Send Clear of hoUserDD
36441>>>>>                End
36441>>>>>>
36441>>>>>            End
36441>>>>>>
36441>>>>>        End
36441>>>>>>
36441>>>>>          
36441>>>>>        Function_Return False
36442>>>>>    End_Function
36443>>>>>    
36443>>>>>    Function IsLoggedIn Returns Boolean
36445>>>>>        String sLoginName
36445>>>>>        Boolean bLogWebSession bLoggedIn
36445>>>>>        
36445>>>>>        Get pbLogWebSession to bLogWebSession
36446>>>>>        If not bLogWebSession Begin
36448>>>>>            Forward Get IsLoggedIn to bLoggedIn
36450>>>>>            Function_Return bLoggedIn
36451>>>>>        End
36451>>>>>>
36451>>>>>        
36451>>>>>        Get psLoginName to sLoginName
36452>>>>>        
36452>>>>>        Function_Return (sLoginName <> "")
36453>>>>>    End_Function
36454>>>>>    
36454>>>>>    
36454>>>>>    //
36454>>>>>    // This procedure is called when validating a session and after logging in. Its purpose is to 
36454>>>>>    // update properties based on the session and user data. Augment this function to update 
36454>>>>>    // properties based on the session / user table. Note that WebAppUser and WebAppSession contain
36454>>>>>    // the right records when this procedure is called.
36454>>>>>    //
36454>>>>>    // Params:
36454>>>>>    //      bClear   True if the procedure is called before session validation to clear properties.
36454>>>>>    //
36454>>>>>    Procedure UpdateSessionProperties Boolean bClear
36456>>>>>        Handle hoUserDD
36456>>>>>        
36456>>>>>        Get phoUserDD to hoUserDD
36457>>>>>        
36457>>>>>        //  Update user properties
36457>>>>>        If (not(bClear) and HasRecord(hoUserDD)) Begin
36459>>>>>            Set psUsername to (Trim(WebAppUser.FullName))
36460>>>>>            Set psLoginName to (Trim(WebAppUser.LoginName))
36461>>>>>            Set piUserRights to WebAppUser.Rights
36462>>>>>            
36462>>>>>            Send OnSessionPropertiesSet 
36463>>>>>        End
36463>>>>>>
36463>>>>>        Else Begin
36464>>>>>            Set psUsername to ""
36465>>>>>            Set psLoginName to ""
36466>>>>>            Set piUserRights to 0
36467>>>>>            
36467>>>>>            Send OnSessionPropertiesClear
36468>>>>>        End
36468>>>>>>
36468>>>>>    End_Procedure
36469>>>>>    
36469>>>>>    //
36469>>>>>    // This function is called to perform the password comparison. It gets the entered password and
36469>>>>>    // the password value of the user table as parameters. The WebAppUser buffer will contain the
36469>>>>>    // right record. This function can be augmented to implement security features like storing the
36469>>>>>    // password as a hashed value.
36469>>>>>    //
36469>>>>>    // Params:
36469>>>>>    //      sUserPassword       Value of the WebAppUser.Password field.
36469>>>>>    //      sEnteredPassword    Value entered on the login screen during login.
36469>>>>>    //
36469>>>>>    Function ComparePasswords String sUserPassword String sEnteredPassword Returns Boolean
36471>>>>>        Function_Return (sUserPassword = sEnteredPassword)
36472>>>>>    End_Function
36473>>>>>    
36473>>>>>    Procedure OnSessionPropertiesSet
36475>>>>>        //  Empty event stub
36475>>>>>    End_Procedure
36476>>>>>    
36476>>>>>    Procedure OnSessionPropertiesClear
36478>>>>>        //  Empty event stub
36478>>>>>    End_Procedure
36479>>>>>    
36479>>>>>    Procedure EndSession
36481>>>>>        Integer iErr
36481>>>>>        Boolean bLogWebSession
36481>>>>>        Handle hoSessionDD       
36481>>>>>        
36481>>>>>        Get phoSessionDD to hoSessionDD
36482>>>>>        Get pbLogWebSession to bLogWebSession
36483>>>>>        If not bLogWebSession Begin
36485>>>>>            Forward Send EndSession
36487>>>>>            Procedure_Return
36488>>>>>        End
36488>>>>>>
36488>>>>>            
36488>>>>>        //  Check if session exists
36488>>>>>        Send Clear of hoSessionDD
36489>>>>>        Get psSessionKey to WebAppSession.SessionKey
36490>>>>>        
36490>>>>>        Send Find of hoSessionDD EQ Index.1
36491>>>>>        If (Found) Begin
36493>>>>>            Set Field_Changed_Value of hoSessionDD Field WebAppSession.Active to "N"
36494>>>>>            Get Request_Validate of hoSessionDD to iErr
36495>>>>>            If (iErr) Begin
36497>>>>>                // this should not happen. If it does its a programming error
36497>>>>>                Error DFERR_PROGRAM C_$WebAppSesionValidateFailed
36498>>>>>>
36498>>>>>                Procedure_Return
36499>>>>>            End
36499>>>>>>
36499>>>>>            Send Request_Save of hoSessionDD
36500>>>>>        End
36500>>>>>>
36500>>>>>    End_Procedure
36501>>>>>
36501>>>>>End_Class
36502>>>>>
36502>>>
36502>>>Object oSessionManager is a cWebSessionManagerStandard
36504>>>End_Object
36505>>>
36505>>>
36505>    Use Login.wo
Including file: Login.wo    (C:\DataFlex Projects\ColegioAppWeb\AppSrc\Login.wo)
36505>>>Use cWebView.pkg
36505>>>Use cWebForm.pkg
36505>>>Use cWebButton.pkg
36505>>>Use cWebPanel.pkg
36505>>>Use cWebLabel.pkg
36505>>>Use cWebSpacer.pkg
36505>>>Use cWebImage.pkg
36505>>>
36505>>>Object oLogin is a cWebView
36507>>>    Set piMinWidth to 250
36508>>>    Set piMaxWidth to 420
36509>>>    Set pbLoginModeEnforced to False
36510>>>    Set piColumnCount to 12
36511>>>    Set psCSSClass to "LoginView"
36512>>>    Set pbServerOnSubmit to True
36513>>>    
36513>>>    Set psStateViewName to "Login"
36514>>>    Set pbStateReplace to True  // Always replace the state so the login never becomes its own history item
36515>>>    
36515>>>    Property String psPrevStateHash ""  // Remember the state hash that the user navigated too so we can redirect after login
36518>>>    
36518>>>    Delegate Set phoLoginView to Self
36520>>>    
36520>>>    Object oTopSpacer is a cWebSpacer
36522>>>        Set pbFillHeight to True
36523>>>        Set piColumnSpan to 12
36524>>>    End_Object
36525>>>    
36525>>>    Object oWarning is a cWebLabel
36527>>>        Set pbVisible to False
36528>>>        Set psCaption to "Invalid User ID or password. \n\rHint: 'Guest' & 'guest'."
36529>>>        Set peAlign to alignCenter
36530>>>        Set piColumnSpan to 12
36531>>>        Set psCSSClass to "LoginWarning"
36532>>>    End_Object
36533>>>    
36533>>>    Object oLogo is a cWebImage
36535>>>        Set piColumnSpan to 10
36536>>>        Set psUrl to "images/DF_Logo_Retina.png"
36537>>>        Set pePosition to wiFit
36538>>>        Set piColumnIndex to 1
36539>>>        Set piHeight to 160
36540>>>        
36540>>>        WebSetResponsive piHeight rmMobile to 100  // Best for small smart phones
36541>>>    End_Object
36542>>>    
36542>>>    Object oLoginName is a cWebForm
36544>>>        Set psLabel to "User ID:"
36545>>>        Set peLabelPosition to lpTop
36546>>>        Set piMaxLength to 20
36547>>>        Set piColumnIndex to 1
36548>>>        Set pbShowLabel to False
36549>>>        Set psPlaceHolder to "loginname"
36550>>>        Set piColumnSpan to 10
36551>>>        Set psAutoComplete to "username"
36552>>>    End_Object
36553>>>    
36553>>>    Object oPassword is a cWebForm
36555>>>        Set psLabel to "Password:"
36556>>>        Set pbPassword to True
36557>>>        Set peLabelAlign to alignLeft
36558>>>        Set piMaxLength to 20
36559>>>        Set peLabelPosition to lpTop
36560>>>        Set pbShowLabel to False
36561>>>        Set psPlaceHolder to "password"
36562>>>        Set piColumnSpan to 10
36563>>>        Set piColumnIndex to 1
36564>>>        Set psAutoComplete to "current-password"
36565>>>    End_Object
36566>>>    
36566>>>    Object oWebSpacer1 is a cWebSpacer
36568>>>        Set piColumnSpan to 12
36569>>>        Set piHeight to 10
36570>>>    End_Object
36571>>>    
36571>>>    Object oLoginButton is a cWebButton
36573>>>        Set pbShowLabel to False
36574>>>        Set psCaption to "sign in"
36575>>>        Set pbServerOnClick to True
36576>>>        Set piColumnSpan to 10
36577>>>        Set piColumnIndex to 1
36578>>>        
36578>>>        Procedure OnClick
36581>>>            Send DoLogin
36582>>>        End_Procedure
36583>>>    End_Object
36584>>>    
36584>>>    Object oBottomSpacer is a cWebSpacer
36586>>>        Set pbFillHeight to True
36587>>>        Set piColumnSpan to 12
36588>>>    End_Object
36589>>>    
36589>>>    Procedure DoLogin
36592>>>        String sLoginName sPassword sPrevStateHash
36592>>>        Boolean bResult
36592>>>        
36592>>>        WebGet psValue of oLoginName to sLoginName
36593>>>        WebGet psValue of oPassword to sPassword
36594>>>        
36594>>>        Get UserLogin of ghoWebSessionManager sLoginName sPassword to bResult
36595>>>        
36595>>>        If (bResult) Begin
36597>>>            Send Hide of oLogin
36598>>>            Send ShowHeader of ghoWebApp
36599>>>            WebSet psCSSClass of ghoWebApp to ""
36600>>>            
36600>>>            WebGet psPrevStateHash to sPrevStateHash
36601>>>            Send NavigateToStateHash of ghoWebApp sPrevStateHash True
36602>>>            
36602>>>            // clear the login values. we don't want to return the login id & password as synchronized properties....
36602>>>            WebSet psValue of oLoginName to ""
36603>>>            WebSet psValue of oPassword  to ""
36604>>>            WebSet pbVisible of oWarning to False
36605>>>        End
36605>>>>
36605>>>        Else Begin
36606>>>            WebSet pbVisible of oWarning to True
36607>>>        End
36607>>>>
36607>>>    End_Procedure
36608>>>    
36608>>>    Procedure OnSubmit
36611>>>        Send DoLogin
36612>>>    End_Procedure
36613>>>    
36613>>>    Procedure OnLoad
36616>>>        String sPrevStateHash sView
36616>>>        
36616>>>        Forward Send OnLoad
36618>>>        
36618>>>        //  Store the current state so we can go back to that later (only if it points to a different view)
36618>>>        Get StateHash of ghoWebApp to sPrevStateHash
36619>>>        Send ParseViewStateHash sPrevStateHash (&sView)
36620>>>        If (Lowercase(sView) <> Lowercase(psStateViewName(Self))) Begin
36622>>>            WebSet psPrevStateHash to sPrevStateHash
36623>>>        End
36623>>>>
36623>>>        
36623>>>    End_Procedure
36624>>>    
36624>>>    Procedure OnBeforeShow
36627>>>        //  Hide header & apply nice background style
36627>>>        Send HideHeader to ghoWebApp
36628>>>        WebSet psCSSClass of ghoWebApp to "LoginBackground"
36629>>>    End_Procedure
36630>>>    
36630>>>End_Object
36631>>>
36631>>>
36631>>>
36631>>>
36631>    Use WebResourceManager.wo
Including file: WebResourceManager.wo    (C:\DataFlex Projects\ColegioAppWeb\AppSrc\WebResourceManager.wo)
36631>>>Use cWebResourceManager.pkg
36631>>>
36631>>>Object oWebResourceManager is a cWebResourceManager
36633>>>End_Object
36634>    
36634>    Use Dashboard.wo
Including file: Dashboard.wo    (C:\DataFlex Projects\ColegioAppWeb\AppSrc\Dashboard.wo)
36634>>>Use cWebView.pkg
36634>>>Use cWebPanel.pkg
36634>>>Use cWebForm.pkg
36634>>>Use cWebButton.pkg
36634>>>Use cWebGroup.pkg
36634>>>Use cWebSpacer.pkg
36634>>>Use cWebHtmlBox.pkg
36634>>>Use cWebMenuGroup.pkg
36634>>>Use cWebMenuItem.pkg
36634>>>Use cWebLabel.pkg
36634>>>Use cWebList.pkg
36634>>>Use cWebColumn.pkg
36634>>>
36634>>>Object oDashboard is a cWebView
36636>>>
36636>>>    // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  
36636>>>    // Add a DDO Structure 
36636>>>    //
36636>>>    // There is no need to synchronize a DD structure on the client so we do
36636>>>    // not set the Server property or send ADDOStructure. We will simply use
36636>>>    // DDO's to mine data and generate HTML for our cWebHTMLBox objects.
36636>>>    // It is the HTML in these objects that is sent to the client each time 
36636>>>    // this page is shown.
36636>>>    //
36636>>>    // Also, it is important for the drill-down Navigation interface that we
36636>>>    // do not set the Server property to some DDO because this will affect 
36636>>>    // constraints in the next view that we navigate to.
36636>>>    // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
36636>>>
36636>>>    Set piMaxWidth to 1024
36637>>>    
36637>>>    Set psCaption to "Menú Inicio"
36638>>>    Set peViewType to vtUndefined
36639>>>    Set pbShowCaption to False
36640>>>    Set psCSSClass to "Dashboard"
36641>>>    
36641>>>    Object oWebMainPanel is a cWebPanel
36643>>>        Set piColumnCount to alignCenter
36644>>>        Set psBackgroundColor to "lightblue"
36645>>>        //Set psHtml to '<div><img src="C:\DataFlex Projects\ColegioAppWeb\Bitmaps\colegio.bmp"></div>'
36645>>>        
36645>>>        // - - - - - - - - - - - - - - -
36645>>>        // Main Panel's Responsive Rules
36645>>>        // - - - - - - - - - - - - - - -
36645>>>        WebSetResponsive piColumnCount rmMobile to 1
36646>>>        WebSetResponsive piColumnCount rmTabletPortrait to 16
36647>>>    
36647>>>        Object oTiles_grp is a cWebGroup
36649>>>            Set piColumnSpan to 1
36650>>>            Set pbShowBorder to False
36651>>>            Set pbShowCaption to False
36652>>>            Set piColumnCount to 12
36653>>>            
36653>>>            Set psCSSClass to "TilesGroup"
36654>>>            Set psBackgroundColor to "lightblue"
36655>>>    
36655>>>            /*Object oWelcomeTile is a cWebHtmlBox                Set piColumnSpan to 6                Set psCSSClass to "Tile Light"                Set psHtml to '<div Class="WebCon_Sizer"><div class="Tile_Title">Inicio</div><div Class="Tile_Subtitle">Pantalla Principal</div></div>'                Set psBackgroundColor to "Green"                Set psToolTip to "Pantalla de inicio"                    Procedure OnLoad                    Send UpdateHTML ('<div class="WebCon_Sizer">' + ;                                     '<div class="Tile_Title">Inicio</div>' +;                                     '<div class="Tile_Subtitle">' - htmlEncode(psUserName(ghoWebSessionManager)) - '</div>' +;                                     '</div>')                End_Procedure                            End_Object*/
36655>>>    
36655>>>            Object oTile2 is a cWebHtmlBox
36657>>>                Set pbServerOnClick to True
36658>>>                Set piColumnSpan to 6
36659>>>                Set psCSSClass to "Tile LightAlternate"
36660>>>                Set psHtml to '<div class="WebCon_Sizer" data-ServerOnClick="openview"><div Class="Tile_Title">Listado de Colegios</div><div class="Tile_Subtitle"></div></div>'
36661>>>                Set psBackgroundColor to "Green"
36662>>>                Set psToolTip to "Colegios"
36663>>>                Set piColumnIndex to 3
36664>>>                                
36664>>>                WebRegisterPath ntNavigateForwardCustom oSelectSchoolHouse
36670>>>                
36670>>>                Procedure OnClick String sId String sParam
36673>>>                    Send NavigatePath
36674>>>                End_Procedure
36675>>>                
36675>>>            End_Object
36676>>>    
36676>>>            Object oTile3 is a cWebHtmlBox
36678>>>                Set pbServerOnClick to True
36679>>>                Set piColumnSpan to 6
36680>>>                Set psCSSClass to "Tile Dark"
36681>>>                Set psHtml to '<div class="WebCon_Sizer" data-ServerOnClick="openview"><div Class="Tile_Title">Listado de Alumnos</div><div class="Tile_Subtitle"></div></div>'
36682>>>                Set psBackgroundColor to "Green"
36683>>>                Set psToolTip to "Alumnos"
36684>>>                Set piColumnIndex to 3
36685>>>    
36685>>>                WebRegisterPath ntNavigateForwardCustom oSelectStudent
36691>>>                
36691>>>                Procedure OnClick String sId String sParam
36694>>>                    Send NavigatePath
36695>>>                End_Procedure
36696>>>                
36696>>>            End_Object
36697>>>    
36697>>>/*            Object oTile4 is a cWebHtmlBox                Set pbServerOnClick to True                Set piColumnSpan to 6                Set piColumnIndex to 6                Set psCSSClass to "Tile DarkAlternate"                Set psHtml to '<div class="WebCon_Sizer" data-ServerOnClick="openview"><div Class="Tile_Title">Tile 4</div><div class="Tile_Subtitle"></div></div>'                            // WebRegisterPath ntNavigateForwardCustom oYourViewName                                Procedure OnClick String sId String sParam                    Send NavigatePath                End_Procedure                            End_Object*/
36697>>>        End_Object
36698>>>    
36698>>>    End_Object
36699>>>    
36699>>>    Procedure OnBeforeShow
36702>>>        // Each time this view is shown we will update the appropriate information.
36702>>>    End_Procedure
36703>>>
36703>>>End_Object
36704>    Use SchoolHouse.wo
Including file: SchoolHouse.wo    (C:\DataFlex Projects\ColegioAppWeb\AppSrc\SchoolHouse.wo)
36704>>>// C:\DataFlex Projects\ColegioAppWeb\AppSrc\SchoolHouse.wo
36704>>>// Colegio
36704>>>//
36704>>>
36704>>>Use cWebView.pkg
36704>>>Use cWebPanel.pkg
36704>>>Use cWebMenuGroup.pkg
36704>>>Use cWebMenuItem.pkg
36704>>>Use cWebForm.pkg
36704>>>Use cWebTabContainer.pkg
36704>>>Use cWebTabPage.pkg
36704>>>Use cWebEdit.pkg
36704>>>
36704>>>Use cschoolhouseDataDictionary.dd
Including file: cschoolhouseDataDictionary.dd    (C:\DataFlex Projects\ColegioAppWeb\DDSrc\cschoolhouseDataDictionary.dd)
36704>>>>>Use DataDict.pkg
36704>>>>>
36704>>>>>//importar el archivo donde tenemos la funcion principal de validacion
36704>>>>>Use ValidarEmail.pkg
Including file: ValidarEmail.pkg    (C:\DataFlex Projects\ColegioAppWeb\AppSrc\ValidarEmail.pkg)
36704>>>>>>>Use cJsonHttpTransfer.pkg
Including file: cJsonHttpTransfer.pkg    (C:\Program Files\DataFlex 24.0\Pkg\cJsonHttpTransfer.pkg)
36704>>>>>>>>>// DF JSON internet transfer class definitions.
36704>>>>>>>>>Use cHttpTransfer.pkg
Including file: cHttpTransfer.pkg    (C:\Program Files\DataFlex 24.0\Pkg\cHttpTransfer.pkg)
36704>>>>>>>>>>>Use VDFBase.pkg
36704>>>>>>>>>>>Use GlobalFunctionsProcedures.pkg
36704>>>>>>>>>>>
36704>>>>>>>>>>>External_Function WinAPI_HttpQueryInfo "HttpQueryInfoW" WinInet.dll ;    Handle hRequest ;    DWord dwInfoLevel ;    Pointer lpBuffer ;    Pointer lpdwBufferLength ;    Pointer lpdwIndex ;    Returns Integer
36705>>>>>>>>>>>
36705>>>>>>>>>>>/*BOOL InternetSetOptionW(  [in] HINTERNET hInternet,  [in] DWORD     dwOption,  [in] LPVOID    lpBuffer,  [in] DWORD     dwBufferLength);*/
36705>>>>>>>>>>>External_Function WinAPI_InternetSetOption "InternetSetOptionW" WinInet.dll ;    Handle hInternet ;    DWord dwOption ;    Pointer lpBuffer ;    DWord dwBufferLength ;    Returns Integer
36706>>>>>>>>>>>
36706>>>>>>>>>>>/*BOOL InternetQueryOptionW(  [in]      HINTERNET hInternet,  [in]      DWORD     dwOption,  [out]     LPVOID    lpBuffer,  [in, out] LPDWORD   lpdwBufferLength);*/
36706>>>>>>>>>>>External_Function WinAPI_InternetQueryOption "InternetQueryOptionW" WinInet.dll ;    Handle hInternet ;    DWord dwOption ;    Pointer lpBuffer ;    Pointer lpdwBufferLength ;    Returns Integer
36707>>>>>>>>>>>
36707>>>>>>>>>>>
36707>>>>>>>>>>>//  Available options for dwInfoLevel of WinAPI_HttpQueryInfo
36707>>>>>>>>>>>Define HTTP_QUERY_MIME_VERSION                for 0
36707>>>>>>>>>>>Define HTTP_QUERY_CONTENT_TYPE                for 1
36707>>>>>>>>>>>Define HTTP_QUERY_CONTENT_TRANSFER_ENCODING   for 2
36707>>>>>>>>>>>Define HTTP_QUERY_CONTENT_ID                  for 3
36707>>>>>>>>>>>Define HTTP_QUERY_CONTENT_DESCRIPTION         for 4
36707>>>>>>>>>>>Define HTTP_QUERY_CONTENT_LENGTH              for 5
36707>>>>>>>>>>>Define HTTP_QUERY_CONTENT_LANGUAGE            for 6
36707>>>>>>>>>>>Define HTTP_QUERY_ALLOW                       for 7
36707>>>>>>>>>>>Define HTTP_QUERY_PUBLIC                      for 8
36707>>>>>>>>>>>Define HTTP_QUERY_DATE                        for 9
36707>>>>>>>>>>>Define HTTP_QUERY_EXPIRES                     for 10
36707>>>>>>>>>>>Define HTTP_QUERY_LAST_MODIFIED               for 11
36707>>>>>>>>>>>Define HTTP_QUERY_MESSAGE_ID                  for 12
36707>>>>>>>>>>>Define HTTP_QUERY_URI                         for 13
36707>>>>>>>>>>>Define HTTP_QUERY_DERIVED_FROM                for 14
36707>>>>>>>>>>>Define HTTP_QUERY_COST                        for 15
36707>>>>>>>>>>>Define HTTP_QUERY_LINK                        for 16
36707>>>>>>>>>>>Define HTTP_QUERY_PRAGMA                      for 17
36707>>>>>>>>>>>Define HTTP_QUERY_VERSION                     for 18  // special: part of status line
36707>>>>>>>>>>>Define HTTP_QUERY_STATUS_CODE                 for 19  // special: part of status line
36707>>>>>>>>>>>Define HTTP_QUERY_STATUS_TEXT                 for 20  // special: part of status line
36707>>>>>>>>>>>Define HTTP_QUERY_RAW_HEADERS                 for 21  // special: all headers as ASCIIZ
36707>>>>>>>>>>>Define HTTP_QUERY_RAW_HEADERS_CRLF            for 22  // special: all headers
36707>>>>>>>>>>>Define HTTP_QUERY_CONNECTION                  for 23
36707>>>>>>>>>>>Define HTTP_QUERY_ACCEPT                      for 24
36707>>>>>>>>>>>Define HTTP_QUERY_ACCEPT_CHARSET              for 25
36707>>>>>>>>>>>Define HTTP_QUERY_ACCEPT_ENCODING             for 26
36707>>>>>>>>>>>Define HTTP_QUERY_ACCEPT_LANGUAGE             for 27
36707>>>>>>>>>>>Define HTTP_QUERY_AUTHORIZATION               for 28
36707>>>>>>>>>>>Define HTTP_QUERY_CONTENT_ENCODING            for 29
36707>>>>>>>>>>>Define HTTP_QUERY_FORWARDED                   for 30
36707>>>>>>>>>>>Define HTTP_QUERY_FROM                        for 31
36707>>>>>>>>>>>Define HTTP_QUERY_IF_MODIFIED_SINCE           for 32
36707>>>>>>>>>>>Define HTTP_QUERY_LOCATION                    for 33
36707>>>>>>>>>>>Define HTTP_QUERY_ORIG_URI                    for 34
36707>>>>>>>>>>>Define HTTP_QUERY_REFERER                     for 35
36707>>>>>>>>>>>Define HTTP_QUERY_RETRY_AFTER                 for 36
36707>>>>>>>>>>>Define HTTP_QUERY_SERVER                      for 37
36707>>>>>>>>>>>Define HTTP_QUERY_TITLE                       for 38
36707>>>>>>>>>>>Define HTTP_QUERY_USER_AGENT                  for 39
36707>>>>>>>>>>>Define HTTP_QUERY_WWW_AUTHENTICATE            for 40
36707>>>>>>>>>>>Define HTTP_QUERY_PROXY_AUTHENTICATE          for 41
36707>>>>>>>>>>>Define HTTP_QUERY_ACCEPT_RANGES               for 42
36707>>>>>>>>>>>Define HTTP_QUERY_SET_COOKIE                  for 43
36707>>>>>>>>>>>Define HTTP_QUERY_COOKIE                      for 44
36707>>>>>>>>>>>Define HTTP_QUERY_REQUEST_METHOD              for 45  // special: GET/POST etc.
36707>>>>>>>>>>>Define HTTP_QUERY_REFRESH                     for 46
36707>>>>>>>>>>>Define HTTP_QUERY_CONTENT_DISPOSITION         for 47
36707>>>>>>>>>>>
36707>>>>>>>>>>>
36707>>>>>>>>>>>Class cHttpTransfer is a cBaseHttpTransfer
36708>>>>>>>>>>>    
36708>>>>>>>>>>>    Function HttpPostRequest String sFilePath String sData Integer bDataIsFile Returns Integer
36710>>>>>>>>>>>        Integer bStat
36710>>>>>>>>>>>        Get HttpPostAddrRequest sFilePath (AddressOf(sData)) (SizeOfString(sData)) bDataIsfile to bStat
36711>>>>>>>>>>>        Function_Return bStat
36712>>>>>>>>>>>    End_Function
36713>>>>>>>>>>>    
36713>>>>>>>>>>>    // This event is triggered from the runtime. It now uses UChar arrays as the data might 
36713>>>>>>>>>>>    // not be a valid string (it can be any binary data). It still calls the original event for 
36713>>>>>>>>>>>    // backwards compatibility.
36713>>>>>>>>>>>    Procedure OnDataReceivedUC String sContentType UChar[] ucData
36715>>>>>>>>>>>        Send OnDataReceived sContentType (UCharArrayToString(ucData))
36716>>>>>>>>>>>    End_Procedure
36717>>>>>>>>>>>    
36717>>>>>>>>>>>    // Only use this event if you know for sure the data is a string and make sure piBufferSize is
36717>>>>>>>>>>>    // smaller than the argument size.
36717>>>>>>>>>>>    Procedure OnDataReceived String sContentType String sData
36719>>>>>>>>>>>        
36719>>>>>>>>>>>    End_Procedure
36720>>>>>>>>>>>    
36720>>>>>>>>>>>    // Called just before the request is sent. Use this message to set options to the RequestHandle if nessecary.
36720>>>>>>>>>>>    Procedure OnPreSendRequest 
36722>>>>>>>>>>>        
36722>>>>>>>>>>>    End_Procedure
36723>>>>>>>>>>>    
36723>>>>>>>>>>>    Function HttpPutRequest String sFilePath String sData Integer bDataIsFile Returns Integer
36725>>>>>>>>>>>        Integer bStat
36725>>>>>>>>>>>        Get HttpPutAddrRequest sFilePath (AddressOf(sData)) (SizeOfString(sData)) bDataIsfile to bStat
36726>>>>>>>>>>>        Function_Return bStat
36727>>>>>>>>>>>    End_Function
36728>>>>>>>>>>>    
36728>>>>>>>>>>>    // Retrieve header information associated with the previous request.
36728>>>>>>>>>>>    Function QueryInfo DWord dwInfoLevel Returns String
36730>>>>>>>>>>>        Handle hRequestHandle
36730>>>>>>>>>>>        WString wResult
36730>>>>>>>>>>>        Integer iBufferSize iRes iVoid
36730>>>>>>>>>>>
36730>>>>>>>>>>>        Get RequestHandle to hRequestHandle
36731>>>>>>>>>>>        
36731>>>>>>>>>>>        If (hRequestHandle) Begin
36733>>>>>>>>>>>            Move 200 to iBufferSize
36734>>>>>>>>>>>            Move (Repeat(" ", iBufferSize)) to wResult
36735>>>>>>>>>>>            Move (WinAPI_HttpQueryInfo(hRequestHandle, dwInfoLevel, AddressOf(wResult), AddressOf(iBufferSize), 0)) to iRes
36736>>>>>>>>>>>            
36736>>>>>>>>>>>            If (not(iRes) and GetLastError() = 122) Begin //  Insufficient buffersize, retry with received iBufferSize value
36738>>>>>>>>>>>                Increment iBufferSize      
36739>>>>>>>>>>>                
36739>>>>>>>>>>>                Move (Repeat(" ", iBufferSize)) to wResult
36740>>>>>>>>>>>                Move (WinAPI_HttpQueryInfo(hRequestHandle, dwInfoLevel, AddressOf(wResult), AddressOf(iBufferSize), 0)) to iRes  
36741>>>>>>>>>>>            End
36741>>>>>>>>>>>>
36741>>>>>>>>>>>            
36741>>>>>>>>>>>            If (not(iRes)) Begin
36743>>>>>>>>>>>                Move (ShowLastError()) to iVoid
36744>>>>>>>>>>>            End
36744>>>>>>>>>>>>
36744>>>>>>>>>>>        End
36744>>>>>>>>>>>>
36744>>>>>>>>>>>        
36744>>>>>>>>>>>        Function_Return (CString(wResult))
36745>>>>>>>>>>>    End_Function
36746>>>>>>>>>>>    
36746>>>>>>>>>>>    // Returns the statustext returned by the previous request.
36746>>>>>>>>>>>    Function ResponseStatusText Returns String
36748>>>>>>>>>>>        String sStatus
36748>>>>>>>>>>>        
36748>>>>>>>>>>>        Get QueryInfo HTTP_QUERY_STATUS_TEXT to sStatus
36749>>>>>>>>>>>        
36749>>>>>>>>>>>        Function_Return sStatus
36750>>>>>>>>>>>    End_Function
36751>>>>>>>>>>>    
36751>>>>>>>>>>>End_Class
36752>>>>>>>>>Use cJsonObject.pkg
36752>>>>>>>>>Use GlobalFunctionsProcedures.pkg
36752>>>>>>>>>
36752>>>>>>>>>// these define the three characters that define BOM for utf8.
36752>>>>>>>>>// These serve no purpos and are rarely used. If used they must be removed
36752>>>>>>>>>Define C_BOM1 for |CI$EF
36752>>>>>>>>>Define C_BOM2 for |CI$BB
36752>>>>>>>>>Define C_BOM3 for |CI$BF
36752>>>>>>>>>
36752>>>>>>>>>
36752>>>>>>>>>
36752>>>>>>>>>// define JSON transfer status codes used by peJsonTransferStatus
36752>>>>>>>>>Enum_List
36752>>>>>>>>>    Define jtsOk                 // ok
36752>>>>>>>>>    Define jtsHttpRequestFailed  // the post/get http request returned an error
36752>>>>>>>>>    Define jtsInvalidContentType // response content type not JSON
36752>>>>>>>>>    Define jtsNotJson            // return value not JSON (could not load in object)
36752>>>>>>>>>    Define jtsError              // unspecified return error
36752>>>>>>>>>End_Enum_List
36752>>>>>>>>>
36752>>>>>>>>>
36752>>>>>>>>>Class cJsonHttpTransfer is a cHttpTransfer
36753>>>>>>>>>    
36753>>>>>>>>>    Procedure Construct_Object
36755>>>>>>>>>        Forward Send Construct_object
36757>>>>>>>>>        
36757>>>>>>>>>        Property String  psContentTypeSent "application/json; charset=utf-8"     // default content type for posted data
36758>>>>>>>>>        
36758>>>>>>>>>        Property Boolean pbClearHeaders      True         // should headers always be cleared after a post
36759>>>>>>>>>        
36759>>>>>>>>>        Property UChar[] pucDataReceived                 // maintained by object
36760>>>>>>>>>        
36760>>>>>>>>>        Property String  psContentTypeReceived ''         // content type received
36761>>>>>>>>>        
36761>>>>>>>>>        Property String  psJsonParseError ''              // Set if response JSON can't be parsed
36762>>>>>>>>>        
36762>>>>>>>>>        Property String  psContentTypeExpected 'application/json' // content type received - expected value should be contained in here.
36763>>>>>>>>>        
36763>>>>>>>>>        Property Integer peJsonTransferStatus jtsOk
36764>>>>>>>>>        
36764>>>>>>>>>        // if true, the http post does not happend and whatever was posted is just returned as a copy.
36764>>>>>>>>>        // Good for internal Testing
36764>>>>>>>>>        Property Boolean pbPostLoopTest False
36765>>>>>>>>>        
36765>>>>>>>>>        Set piBufferSize to -1  //  No chunking needed
36766>>>>>>>>>    End_Procedure
36767>>>>>>>>>    
36767>>>>>>>>>    // private helper function. Convert data passed by pointer to an JSON document.
36767>>>>>>>>>    // return 0, if error
36767>>>>>>>>>    //
36767>>>>>>>>>    Function UCharDatatoJson UChar[] ucJson Returns Handle
36769>>>>>>>>>        Integer iVoid bOk
36769>>>>>>>>>        Handle hoJson
36769>>>>>>>>>        String sError
36769>>>>>>>>>        Get Create of Desktop (RefClass(cJsonObject)) to hoJson
36770>>>>>>>>>        Get ParseUTF8 of hoJson ucJson to bOk
36771>>>>>>>>>        If not bOk Begin
36773>>>>>>>>>            // store the JSON parse error info
36773>>>>>>>>>            Get psParseError of hoJson to sError
36774>>>>>>>>>            Set psJsonParseError to sError
36775>>>>>>>>>            Send Destroy of hoJson
36776>>>>>>>>>            Move 0 to hoJson
36777>>>>>>>>>        End
36777>>>>>>>>>>
36777>>>>>>>>>        Function_Return hoJson
36778>>>>>>>>>    End_Function
36779>>>>>>>>>    
36779>>>>>>>>>    // Clear pucDataReceived
36779>>>>>>>>>    Procedure ClearDataReceived
36781>>>>>>>>>        UChar[] ucEmpty
36782>>>>>>>>>        
36782>>>>>>>>>        Set pucDataReceived to ucEmpty
36783>>>>>>>>>        Set psJsonParseError to ''
36784>>>>>>>>>    End_Procedure
36785>>>>>>>>>    
36785>>>>>>>>>    // augment to release any memor
36785>>>>>>>>>    Procedure Destroy_Object
36787>>>>>>>>>        Send ClearDataReceived
36788>>>>>>>>>        Forward Send Destroy_object
36790>>>>>>>>>    End_Procedure
36791>>>>>>>>>    
36791>>>>>>>>>    // called during http transfer. Take passed data and append to pucDataReceived.
36791>>>>>>>>>    // If new transfer save contenttype.
36791>>>>>>>>>    Procedure OnDataReceivedUC String sContentType UChar[] ucData
36793>>>>>>>>>        UChar[] ucBuffer
36794>>>>>>>>>        Integer iDataLen
36794>>>>>>>>>        
36794>>>>>>>>>        Move (SizeOfArray(ucData)) to iDataLen
36795>>>>>>>>>        
36795>>>>>>>>>        If (iDataLen > 0) Begin
36797>>>>>>>>>            Get pucDataReceived to ucBuffer
36798>>>>>>>>>            If (SizeOfArray(ucBuffer) > 0) Begin
36800>>>>>>>>>                Set pucDataReceived to (AppendArray(ucBuffer, ucData))
36801>>>>>>>>>            End
36801>>>>>>>>>>
36801>>>>>>>>>            Else Begin
36802>>>>>>>>>                Set psContentTypeReceived to sContentType
36803>>>>>>>>>                
36803>>>>>>>>>                If (iDataLen > 3 and ucData[0]=C_BOM1 and ucData[1]=C_BOM2 and ucData[2]=C_BOM3) Begin
36805>>>>>>>>>                    Set pucDataReceived to (CopyArray(ucData, 3, iDataLen - 1))
36806>>>>>>>>>                End
36806>>>>>>>>>>
36806>>>>>>>>>                Else Begin
36807>>>>>>>>>                    Set pucDataReceived to ucData
36808>>>>>>>>>                End
36808>>>>>>>>>>
36808>>>>>>>>>            End
36808>>>>>>>>>>
36808>>>>>>>>>        End
36808>>>>>>>>>>
36808>>>>>>>>>    End_Procedure
36809>>>>>>>>>    
36809>>>>>>>>>    Function LoopDataBack UChar[] ucData Returns Boolean
36811>>>>>>>>>        Pointer pInData
36811>>>>>>>>>        Boolean bOk
36811>>>>>>>>>        
36811>>>>>>>>>        Set pucDataReceived to ucData
36812>>>>>>>>>        Set psContentTypeReceived to (psContentTypeExpected(Self))
36813>>>>>>>>>        
36813>>>>>>>>>        Function_Return True
36814>>>>>>>>>    End_Function
36815>>>>>>>>>    
36815>>>>>>>>>    
36815>>>>>>>>>    Function HttpVerbJsonAddrExec String sHost String sFilePath Pointer pJson Integer iLen String sVerb  Returns Boolean
36817>>>>>>>>>        Boolean bOk
36817>>>>>>>>>        Integer iError
36817>>>>>>>>>        String sContentType
36817>>>>>>>>>        
36817>>>>>>>>>        Send ClearDataReceived  // this should be zero, just in case it is not
36818>>>>>>>>>        Set psRemoteHost to sHost
36819>>>>>>>>>        
36819>>>>>>>>>        Get psContentTypeSent to sContentType
36820>>>>>>>>>        If (iLen > 0 and sContentType <> "") Begin
36822>>>>>>>>>            Get AddHeader "Content-Type" sContentType to bok
36823>>>>>>>>>        End
36823>>>>>>>>>>
36823>>>>>>>>>        Get HttpVerbAddrRequest sFilePath pJson iLen False sVerb to bOK
36824>>>>>>>>>        
36824>>>>>>>>>        // You need to clear headers between posts. If you need to set custom headers you should
36824>>>>>>>>>        // set pbClearHeaders to false and then manually send ClearHeaders and AddHeaders in your code
36824>>>>>>>>>        If (pbClearHeaders(Self)) ;            Send ClearHeaders
36827>>>>>>>>>        
36827>>>>>>>>>        
36827>>>>>>>>>        Function_Return bOk
36828>>>>>>>>>    End_Function
36829>>>>>>>>>    
36829>>>>>>>>>    // We assume but do not verify that the data in ucJson is actually UTF8 JSON
36829>>>>>>>>>    Function HttpVerbJsonUChar String sHost String sFilePath UChar[] ucJson String sVerb Returns UChar[]
36831>>>>>>>>>        Integer iLen
36831>>>>>>>>>        Boolean bOk
36831>>>>>>>>>        UChar[] ucJsonReceived
36832>>>>>>>>>        String sContentTypeReceived sContentTypeExpected
36832>>>>>>>>>        
36832>>>>>>>>>        Move (SizeOfArray(ucJson)) to iLen
36833>>>>>>>>>        
36833>>>>>>>>>        If (pbPostLoopTest(Self)) Begin
36835>>>>>>>>>            Get LoopDataBack ucJson to bOk
36836>>>>>>>>>        End
36836>>>>>>>>>>
36836>>>>>>>>>        Else Begin
36837>>>>>>>>>            Get HttpVerbJsonAddrExec sHost sFilePath (AddressOf(ucJson)) iLen sVerb to bOk
36838>>>>>>>>>        End
36838>>>>>>>>>>
36838>>>>>>>>>                
36838>>>>>>>>>        If bOk Begin
36840>>>>>>>>>            Set peJsonTransferStatus to jtsOk
36841>>>>>>>>>            Get pucDataReceived to ucJsonReceived
36842>>>>>>>>>            
36842>>>>>>>>>            If (SizeOfArray(ucJsonReceived) > 0) Begin
36844>>>>>>>>>                // we have data, check that the content type is ok. This is as far
36844>>>>>>>>>                // as we can go here.
36844>>>>>>>>>                Get psContentTypeReceived to sContentTypeReceived
36845>>>>>>>>>                Get psContentTypeExpected to sContentTypeExpected
36846>>>>>>>>>                // If contentType expected is empty, we allow anything
36846>>>>>>>>>                If (sContentTypeExpected<>"" and pos(lowercase(sContentTypeExpected),lowercase(sContentTypeReceived))=0) Begin
36848>>>>>>>>>                    Set peJsonTransferStatus to jtsInvalidContentType
36849>>>>>>>>>                End
36849>>>>>>>>>>
36849>>>>>>>>>            End
36849>>>>>>>>>>
36849>>>>>>>>>        End
36849>>>>>>>>>>
36849>>>>>>>>>        Else Begin
36850>>>>>>>>>            Set peJsonTransferStatus to jtsHttpRequestFailed
36851>>>>>>>>>        End
36851>>>>>>>>>>
36851>>>>>>>>>                
36851>>>>>>>>>        Function_Return ucJsonReceived
36852>>>>>>>>>    End_Function
36853>>>>>>>>>    
36853>>>>>>>>>    // Generic HTTP Request - it is passed the Verb. Used by all other http requests
36853>>>>>>>>>    Function HttpVerbJson  String sHost String sFilePath Handle  hoJsonRequest String sVerb Boolean ByRef bOk Returns Handle
36855>>>>>>>>>        UChar[] ucJsonRequest ucJsonResponse
36857>>>>>>>>>        Handle hoJsonResponse
36857>>>>>>>>>        Integer eStat
36857>>>>>>>>>        
36857>>>>>>>>>        If (hoJsonRequest<>0) Begin
36859>>>>>>>>>            Get StringifyUTF8 of hoJsonRequest to ucJsonRequest
36860>>>>>>>>>        End
36860>>>>>>>>>>
36860>>>>>>>>>        
36860>>>>>>>>>        Get HttpVerbJsonUChar sHost sFilePath ucJsonRequest sVerb to ucJsonResponse
36861>>>>>>>>>        
36861>>>>>>>>>        If (SizeOfArray(ucJsonResponse)) Begin
36863>>>>>>>>>            Get UCharDatatoJson ucJsonResponse to hoJsonResponse
36864>>>>>>>>>            If (hoJsonResponse=0) Begin
36866>>>>>>>>>                // this indicates that data was returned but it could not be loaded as Json
36866>>>>>>>>>                Set peJsonTransferStatus to jtsNotJson
36867>>>>>>>>>                // note bad data is still is ppDataReceived (might be useful for debugging)
36867>>>>>>>>>            End
36867>>>>>>>>>>
36867>>>>>>>>>        End
36867>>>>>>>>>>
36867>>>>>>>>>        
36867>>>>>>>>>        // return Ok status by reference
36867>>>>>>>>>        Get peJsonTransferStatus to eStat
36868>>>>>>>>>        Move (eStat=jtsOk) to bOk
36869>>>>>>>>>        
36869>>>>>>>>>        Function_Return hoJsonResponse
36870>>>>>>>>>    End_Function
36871>>>>>>>>>    
36871>>>>>>>>>    Function HttpPostJson String sHost String sFilePath Handle hoJsonRequest Boolean ByRef bOk Returns Handle
36873>>>>>>>>>        Handle hoJson
36873>>>>>>>>>        Get HttpVerbJson sHost sFilePath hoJsonRequest "POST" (&bOk) to hoJson
36874>>>>>>>>>        Function_Return hoJson
36875>>>>>>>>>    End_Function
36876>>>>>>>>>    
36876>>>>>>>>>    Function HttpGetJson String sHost String sFilePath Boolean ByRef bOk Returns Handle
36878>>>>>>>>>        Pointer pJson
36878>>>>>>>>>        Integer iVoid iLen
36878>>>>>>>>>        Handle hoJson
36878>>>>>>>>>        Get HttpVerbJson sHost sFilePath 0 "GET" (&bOk) to hoJson
36879>>>>>>>>>        Function_Return hoJson
36880>>>>>>>>>    End_Function
36881>>>>>>>>>    
36881>>>>>>>>>    Function HttpPutJson String sHost String sFilePath Handle hoJsonRequest Boolean ByRef bOk Returns Handle
36883>>>>>>>>>        Handle hoJson
36883>>>>>>>>>        Get HttpVerbJson sHost sFilePath hoJsonRequest "PUT" (&bOk) to hoJson
36884>>>>>>>>>        Function_Return hoJson
36885>>>>>>>>>    End_Function
36886>>>>>>>>>    
36886>>>>>>>>>    Function HttpDeleteJson String sHost String sFilePath Handle hoJsonRequest Boolean ByRef bOk Returns Handle
36888>>>>>>>>>        Handle hoJson
36888>>>>>>>>>        Get HttpVerbJson sHost sFilePath hoJsonRequest "DELETE" (&bOk) to hoJson
36889>>>>>>>>>        Function_Return hoJson
36890>>>>>>>>>    End_Function
36891>>>>>>>>>    
36891>>>>>>>>>    Function HttpPatchJson  String sHost String sFilePath Handle hoJsonRequest Boolean ByRef bOk Returns Handle
36893>>>>>>>>>        Handle hoJson
36893>>>>>>>>>        Get HttpVerbJson sHost sFilePath hoJsonRequest "PATCH" (&bOk) to hoJson
36894>>>>>>>>>        Function_Return hoJson
36895>>>>>>>>>    End_Function
36896>>>>>>>>>    
36896>>>>>>>>>    // After an Json xfer request this message can be sent to display an error message if one occurred.
36896>>>>>>>>>    // Normally you would first check peJsonTransferStatus to see if it is not jtsOk. If not, send
36896>>>>>>>>>    // LastError to see the error
36896>>>>>>>>>    
36896>>>>>>>>>    // return last JSON transfer error text
36896>>>>>>>>>    Function TransferErrorDescription Returns String
36898>>>>>>>>>        String  sError sJsonError
36898>>>>>>>>>        Integer eJsonTransferStatus
36898>>>>>>>>>        Get peJsonTransferStatus to eJsonTransferStatus
36899>>>>>>>>>        Get psJsonParseError to sJsonError
36900>>>>>>>>>        Case Begin
36900>>>>>>>>>            Case (eJsonTransferStatus=jtsOk) ;                Move '' to sError
36903>>>>>>>>>            Case (eJsonTransferStatus=jtsHttpRequestFailed) ;                Move C_$HttpRequestFailed to sError
36907>>>>>>>>>            Case (eJsonTransferStatus=jtsInvalidContentType) ;                Move (SFormat(C_$InvalidContentTypeReceived,psContentTypeReceived(Self))) to sError
36911>>>>>>>>>            Case (eJsonTransferStatus=jtsNotJson) ;                Move (C_$ReceivedDataNotInJsonFormat * sJsonError) to sError
36915>>>>>>>>>            Case Else ;                Move C_$ReceivedDataIsBad to sError
36917>>>>>>>>>        Case End
36917>>>>>>>>>        Function_Return sError
36918>>>>>>>>>    End_Function
36919>>>>>>>>>    
36919>>>>>>>>>    // can be send to raise an error.
36919>>>>>>>>>    Procedure LastError
36921>>>>>>>>>        Integer eJsonTransferStatus
36921>>>>>>>>>        String sError
36921>>>>>>>>>        
36921>>>>>>>>>        Get peJsonTransferStatus to eJsonTransferStatus
36922>>>>>>>>>        If (eJsonTransferStatus<>jtsOk) Begin
36924>>>>>>>>>            Get TransferErrorDescription to sError
36925>>>>>>>>>            Error DFERR_JSON_HTTP sError
36926>>>>>>>>>>
36926>>>>>>>>>        End
36926>>>>>>>>>>
36926>>>>>>>>>    End_Procedure
36927>>>>>>>>>    
36927>>>>>>>>>    
36927>>>>>>>>>End_Class
36928>>>>>>>
36928>>>>>>>Define cValidos for "ABCDEFGHIJKLMNÑOPQRSTUVWXYZ0123456789._-"
36928>>>>>>>
36928>>>>>>>
36928>>>>>>>Function ValidarEmail String sEmail String ByRef sMsg Returns Boolean
36931>>>>>>>    Boolean bRet
36931>>>>>>>    Move (Uppercase(sEmail)) to sEmail
36932>>>>>>>    Move (Trim(sEmail)) to sEmail
36933>>>>>>>//-----------------------------------------------------------------------------------------------    
36933>>>>>>>    
36933>>>>>>>//-------------------------------------detecta cadena vacia    
36933>>>>>>>    If (sEmail="")Begin
36935>>>>>>>        Move "Escribe algo miarma" to sMsg
36936>>>>>>>        Function_Return False
36937>>>>>>>    End
36937>>>>>>>>
36937>>>>>>>    //--------------
36937>>>>>>>    
36937>>>>>>>    
36937>>>>>>>//-------------------------------------valiada total de caracteres < 256
36937>>>>>>>    If (Length(sEmail)>=256)Begin
36939>>>>>>>        Move "La extensión total no debe superar los 256 caracteres" to sMsg
36940>>>>>>>        Function_Return False
36941>>>>>>>    End
36941>>>>>>>>
36941>>>>>>>    //-------------
36941>>>>>>>
36941>>>>>>>
36941>>>>>>>//------------------------------------NO comienza ni termina con punto
36941>>>>>>>    If (Left(sEmail,1)="." or Right(sEmail,1)=".")Begin
36943>>>>>>>        Move "Un Email no puede empezar ni terminar en punto '.'" to sMsg
36944>>>>>>>        Function_Return False
36945>>>>>>>    End
36945>>>>>>>>
36945>>>>>>>    //------------
36945>>>>>>>    
36945>>>>>>>//------------------------------------Verificar puntos CONSECUTIVOS
36945>>>>>>>    If (Pos("..", sEmail) > 0) Begin
36947>>>>>>>        Move "No puede haber nunca dos o más puntos '.' seguidos" to sMsg
36948>>>>>>>        Function_Return False
36949>>>>>>>    End
36949>>>>>>>>
36949>>>>>>>    //---------
36949>>>>>>>
36949>>>>>>>//------------------------------------Verificar si el email contiene "@" correctamente
36949>>>>>>>    Get ValidarArroba sEmail (&sMsg) to bRet
36950>>>>>>>    
36950>>>>>>>    If (not(bRet)) Begin
36952>>>>>>>        Move "El email debe contener uno y solo un @" to sMsg
36953>>>>>>>        Function_Return False
36954>>>>>>>    End
36954>>>>>>>>
36954>>>>>>>    //----------
36954>>>>>>>    
36954>>>>>>>//-------------------------------------Verificar si la parte LOCAL tiene entre 1 y 64 caracteres    
36954>>>>>>>    Get LongitudParteLocal sEmail (&sMsg) to bRet
36955>>>>>>>    
36955>>>>>>>    If (not(bRet)) Begin
36957>>>>>>>        Move "La longitud antes del @ no es válida. Tiene que tener entre 1 y 64 caracteres" to sMsg
36958>>>>>>>        Function_Return False
36959>>>>>>>    End
36959>>>>>>>>
36959>>>>>>>    //---------
36959>>>>>>>    
36959>>>>>>>//-------------------------------------Verificar si la parte DOMINIO tiene entre 4 y 255 caracteres
36959>>>>>>>    Get LongitudParteDominio sEmail (&sMsg) to bRet
36960>>>>>>>    
36960>>>>>>>    If (not(bRet)) Begin
36962>>>>>>>        Move "La longitud DESPUES del @ no es válida tiene que tener entre 4 y 255 caracteres acabado en punto y la extensión" to sMsg
36963>>>>>>>        Function_Return False
36964>>>>>>>    End
36964>>>>>>>>
36964>>>>>>>    //---------
36964>>>>>>>    
36964>>>>>>>//-------------------------------------Verificar primer digito de cada parte Alfanumerico
36964>>>>>>>    Get PrimerAlfanumerico sEmail (&sMsg) to bRet
36965>>>>>>>    
36965>>>>>>>    If (not(bRet)) Begin
36967>>>>>>>        Move "El PRIMER CARACTER de la parte LOCAL y de la parte despues del @ tiene que ser LETRA o NÚMERO" to sMsg
36968>>>>>>>        Function_Return False
36969>>>>>>>    End
36969>>>>>>>>
36969>>>>>>>
36969>>>>>>>//------------------------------------verificar que todos los digitos sean válidos
36969>>>>>>>    Get DigitosValidos sEmail (&sMsg) to bRet
36970>>>>>>>    
36970>>>>>>>    If (not(bRet))Begin
36972>>>>>>>        Move "Los unicos simbolos válidos son: .   _  - " to sMsg
36973>>>>>>>        Function_Return False
36974>>>>>>>    End
36974>>>>>>>>
36974>>>>>>>    //----------
36974>>>>>>>    
36974>>>>>>>//----------------------------------verificar la longitud de la extensión
36974>>>>>>>    Get Extension sEmail (&sMsg) to bRet
36975>>>>>>>    
36975>>>>>>>    If (not(bRet)) Begin
36977>>>>>>>        Move "la extension debe estar entre 2 y 4 caracteres" to sMsg
36978>>>>>>>        Function_Return False
36979>>>>>>>    End
36979>>>>>>>>
36979>>>>>>>    //---------
36979>>>>>>>    
36979>>>>>>>    
36979>>>>>>>//---------------------------------verificar el Email desde la API (NEUTRINO)
36979>>>>>>>    Get ValidacionAPI sEmail (&sMsg) to bRet
36980>>>>>>>
36980>>>>>>>    Function_Return bRet
36981>>>>>>>
36981>>>>>>>//---------------------------------------------------------------------------------------------------
36981>>>>>>>    Function_Return True
36982>>>>>>>End_Function
36983>>>>>>>
36983>>>>>>>//----------------------------------Función para verificar si el email contiene al menos y solo un "@".
36983>>>>>>>Function ValidarArroba String sEmail String ByRef sMsg Returns Boolean
36986>>>>>>>    Integer iCount iArrobaCount
36986>>>>>>>    Boolean bRet
36986>>>>>>>    
36986>>>>>>>    // Inicializar el contador de "@" a cero
36986>>>>>>>    Move 0 to iArrobaCount
36987>>>>>>>    
36987>>>>>>>    // Contar el número de "@" en el email
36987>>>>>>>    For iCount from 1 to (Length(sEmail))
36993>>>>>>>>
36993>>>>>>>        If (Mid(sEmail, 1, iCount) = "@") Begin
36995>>>>>>>            // Incrementar el contador de "@" si se encuentra uno
36995>>>>>>>            Increment iArrobaCount
36996>>>>>>>        End
36996>>>>>>>>
36996>>>>>>>    Loop
36997>>>>>>>>
36997>>>>>>>    
36997>>>>>>>    // Verificar si hay exactamente un "@" en el email
36997>>>>>>>    If (iArrobaCount = 1) Begin
36999>>>>>>>        // Si hay exactamente un "@" devuelve verdadero
36999>>>>>>>        Move True to bRet
37000>>>>>>>    End
37000>>>>>>>>
37000>>>>>>>    Else Begin
37001>>>>>>>        // Si hay mas de un "@" devolver falso
37001>>>>>>>        Move False to bRet
37002>>>>>>>    End
37002>>>>>>>>
37002>>>>>>>    
37002>>>>>>>    // Retornar el resultado de la validación, si solo hay un @ devuelve verdadero.
37002>>>>>>>    Function_Return bRet
37003>>>>>>>End_Function
37004>>>>>>>
37004>>>>>>>//----------------------------------Función para verificar la longitud de la parte local del email.
37004>>>>>>>Function LongitudParteLocal String sEmail String ByRef sMsg Returns Boolean
37007>>>>>>>    Integer iPos
37007>>>>>>>    String sParteLocal
37007>>>>>>>    Boolean bRet
37007>>>>>>>
37007>>>>>>>    // Encontrar la posición del "@" en el correo electrónico
37007>>>>>>>    Move (Pos("@", sEmail)) to iPos
37008>>>>>>>    
37008>>>>>>>    // Extraer la parte local del correo electrónico
37008>>>>>>>    Move (Left(sEmail, iPos - 1)) to sParteLocal
37009>>>>>>>    
37009>>>>>>>    // Verificar si la longitud de la parte local es válida
37009>>>>>>>    If (Length(sParteLocal) >= 1 and Length(sParteLocal) <= 64) Begin
37011>>>>>>>        // Si la longitud es correcta, devolver verdadero
37011>>>>>>>        Move True to bRet
37012>>>>>>>    End
37012>>>>>>>>
37012>>>>>>>    Else Begin
37013>>>>>>>        // Si la longitud no es válida, devolver falso
37013>>>>>>>        Move False to bRet
37014>>>>>>>    End
37014>>>>>>>>
37014>>>>>>>    
37014>>>>>>>    Function_Return bRet
37015>>>>>>>End_Function
37016>>>>>>>
37016>>>>>>>//----------------------------------Función para verificar la longitud de la parte de DOMINIO del email.
37016>>>>>>>Function LongitudParteDominio String sEmail String ByRef sMsg Returns Boolean
37019>>>>>>>    Integer iPos iPunto
37019>>>>>>>    String sParteDominio
37019>>>>>>>    Boolean bRet
37019>>>>>>>
37019>>>>>>>    // Encontrar la posición del "@" en el correo electrónico
37019>>>>>>>    Move (Pos("@", sEmail)) to iPos
37020>>>>>>>    
37020>>>>>>>    // Extraer la parte de dominio del correo electrónico
37020>>>>>>>    Move (Mid(sEmail, 255, iPos + 1)) to sParteDominio
37021>>>>>>>    Move (RightPos(".", sParteDominio)) to iPunto
37022>>>>>>>    
37022>>>>>>>    // verificar si antes del el ultimo punto hay mas de 4 caracteres
37022>>>>>>>    If (iPunto < 5) Begin
37024>>>>>>>        Move False to bRet
37025>>>>>>>        Function_Return bRet
37026>>>>>>>    End
37026>>>>>>>>
37026>>>>>>>    
37026>>>>>>>    // Verificar si la longitud de la parte de dominio es válida
37026>>>>>>>    If (Length(sParteDominio) >= 4 and Length(sParteDominio) <= 255) Begin
37028>>>>>>>        // Si la longitud es válida, devolver verdadero
37028>>>>>>>        Move True to bRet
37029>>>>>>>    End
37029>>>>>>>>
37029>>>>>>>    Else Begin
37030>>>>>>>        // Si la longitud no es válida, devolver falso
37030>>>>>>>        Move False to bRet
37031>>>>>>>    End
37031>>>>>>>>
37031>>>>>>>    
37031>>>>>>>    // Retornar el resultado de la validación
37031>>>>>>>    Function_Return bRet
37032>>>>>>>End_Function
37033>>>>>>>
37033>>>>>>>
37033>>>>>>>//------------------------------------------------verificar la extension del dominio
37033>>>>>>>Function Extension String sEmail String ByRef sMsg Returns Boolean
37036>>>>>>>    Boolean bRet
37036>>>>>>>    String sParteDominio sExten
37036>>>>>>>    Integer iPos iPunto iLongExten
37036>>>>>>>    
37036>>>>>>>    // Encontrar la posición del "@" en el correo electrónico
37036>>>>>>>    Move (Pos("@", sEmail)) to iPos
37037>>>>>>>    // Extraer la parte de dominio del correo electrónico
37037>>>>>>>    Move (Mid(sEmail, 255, iPos + 1)) to sParteDominio
37038>>>>>>>    //---------esta sentencia me dice cual el es ultimo punto de la cadena
37038>>>>>>>    Move (RightPos(".", sParteDominio)) to iPunto
37039>>>>>>>    
37039>>>>>>>    // Extraer la parte de la extensión del correo electrónico
37039>>>>>>>    Move (Mid(sParteDominio, 5, iPunto+1)) to sExten
37040>>>>>>>    
37040>>>>>>>    // Calcular la longitud total de la extensión
37040>>>>>>>    Move (Length(sExten)) to iLongExten
37041>>>>>>>    
37041>>>>>>>    // Verificar si la longitud de la parte del dominio del correo electrónico es superior a 2
37041>>>>>>>    Move True to bRet
37042>>>>>>>    If (iLongExten < 2 or iLongExten > 4) Begin
37044>>>>>>>        Move False to bRet
37045>>>>>>>        Function_Return bRet
37046>>>>>>>    End
37046>>>>>>>>
37046>>>>>>>    
37046>>>>>>>    Function_Return bRet    
37047>>>>>>>End_Function
37048>>>>>>>
37048>>>>>>>//----------------------------------Función para verificar que la parte local y la parte de dominio comiencen por letra o dígito
37048>>>>>>>Function PrimerAlfanumerico String sEmail String ByRef sMsg Returns Boolean
37051>>>>>>>    Boolean bRet
37051>>>>>>>    Integer iCount iCount2 iPos
37051>>>>>>>    String sPrimerDL sPrimerDD sChar sChar2
37051>>>>>>>
37051>>>>>>>    //iniciamos el boleano como falso
37051>>>>>>>    Move False to bRet
37052>>>>>>>        
37052>>>>>>>    //declaramos el primer digito de cada parte
37052>>>>>>>    Move (Left(sEmail,1)) to sPrimerDL
37053>>>>>>>    
37053>>>>>>>    Move (Pos("@", sEmail)) to iPos
37054>>>>>>>    Move (Mid(sEmail, 1, iPos + 1)) to sPrimerDD
37055>>>>>>>    
37055>>>>>>>    //buscamos que el primer digito de la parte LOCAL coincida con la constante quitando los simbolos 
37055>>>>>>>    For iCount from 1 to (Length(cValidos)-3)
37061>>>>>>>>
37061>>>>>>>        Move (Mid(cValidos, 1, iCount)) to sChar
37062>>>>>>>            If (sChar = sPrimerDL)Begin
37064>>>>>>>                Move True to bRet  
37065>>>>>>>            End
37065>>>>>>>>
37065>>>>>>>            If (bRet) Begin
37067>>>>>>>               
37067>>>>>>>    //buscamos que el primer digito de la parte DOMINIO coincida con la constante quitando los simbolos
37067>>>>>>>            Move False to bRet
37068>>>>>>>        For iCount2 from 1 to (Length(cValidos)-3)
37074>>>>>>>>
37074>>>>>>>            Move (Mid(cValidos, 1, iCount2)) to sChar2
37075>>>>>>>                If (sChar2 = sPrimerDD)Begin
37077>>>>>>>                    Move True to bRet
37078>>>>>>>                    Function_Return bRet
37079>>>>>>>                 End
37079>>>>>>>>
37079>>>>>>>         Loop    
37080>>>>>>>>
37080>>>>>>>                
37080>>>>>>>            End      
37080>>>>>>>>
37080>>>>>>>    Loop
37081>>>>>>>>
37081>>>>>>>        Function_Return bRet
37082>>>>>>>End_Function
37083>>>>>>>
37083>>>>>>>
37083>>>>>>>//------------------------------------------Función para verificar que el resto de digitos sean válidos
37083>>>>>>>Function DigitosValidos String sEmail String ByRef sMsg Returns Boolean
37086>>>>>>>    Boolean bRet
37086>>>>>>>    Integer iPos iPunto iCount iCount2 iCount3 iCount4
37086>>>>>>>    String sParteLocal sParteDominio sLocalChar sLocalChar2 sDominChar sDominChar2
37086>>>>>>>    
37086>>>>>>>    //----------------encontrar el arroba y dividir en partes
37086>>>>>>>    Move (Pos("@", sEmail)) to iPos
37087>>>>>>>    
37087>>>>>>>    //----------extraemos la parte local
37087>>>>>>>    Move (Left(sEmail, iPos - 1)) to sParteLocal
37088>>>>>>>    
37088>>>>>>>    //---------extraemos la parte dominio
37088>>>>>>>    Move (Mid(sEmail, 255, iPos + 1)) to sParteDominio
37089>>>>>>>
37089>>>>>>>
37089>>>>>>>    //---------------------------------verificar la parte LOCAL
37089>>>>>>>    For iCount from 1 to (Length(sParteLocal))
37095>>>>>>>>
37095>>>>>>>        Move (Mid(sParteLocal, 1, iCount)) to sLocalChar
37096>>>>>>>        Move False to bRet
37097>>>>>>>        For iCount2 from 1 to (Length(cValidos))
37103>>>>>>>>
37103>>>>>>>            Move (Mid(cValidos, 1, iCount2)) to sLocalChar2
37104>>>>>>>            If (sLocalChar = sLocalChar2) Begin
37106>>>>>>>                Move True to bRet
37107>>>>>>>            End
37107>>>>>>>>
37107>>>>>>>        Loop
37108>>>>>>>>
37108>>>>>>>        If (not (bRet)) Begin
37110>>>>>>>            Function_Return bRet
37111>>>>>>>        End
37111>>>>>>>>
37111>>>>>>>    Loop
37112>>>>>>>>
37112>>>>>>>
37112>>>>>>>
37112>>>>>>>    //------------------------------verificar la parte DOMINIO
37112>>>>>>>    For iCount3 from 1 to (Length(sParteDominio))
37118>>>>>>>>
37118>>>>>>>        Move (Mid(sParteDominio, 1, iCount3)) to sDominChar
37119>>>>>>>        Move False to bRet
37120>>>>>>>        For iCount4 from 1 to (Length(cValidos))
37126>>>>>>>>
37126>>>>>>>            Move (Mid(cValidos, 1, iCount4)) to sDominChar2
37127>>>>>>>            If (sDominChar = sDominChar2) Begin
37129>>>>>>>                Move True to bRet
37130>>>>>>>            End
37130>>>>>>>>
37130>>>>>>>        Loop
37131>>>>>>>>
37131>>>>>>>        If (not (bRet)) Begin
37133>>>>>>>            Function_Return bRet
37134>>>>>>>        End
37134>>>>>>>>
37134>>>>>>>    Loop
37135>>>>>>>>
37135>>>>>>>
37135>>>>>>>    Function_Return bRet
37136>>>>>>>End_Function
37137>>>>>>>
37137>>>>>>>//----------------------------------------------Función para validar el email desde una api (Neutrino)
37137>>>>>>>Function ValidacionAPI String sEmail String ByRef sMsg Returns Boolean
37140>>>>>>>    Handle hoHttp hoJsonRequest hoResponse
37140>>>>>>>    Boolean bRet bIsnull
37140>>>>>>>    String sResponse sResponse2
37140>>>>>>>    
37140>>>>>>>    //Documentación de referencia: https://www.neutrinoapi.com/api/email-validate/
37140>>>>>>>    
37140>>>>>>>    Get Create (RefClass(cJsonHttpTransfer)) to hoHttp
37141>>>>>>>    Get Create (RefClass(cJsonObject))       to hoJsonRequest
37142>>>>>>>    
37142>>>>>>>    Send InitializeJsonType of hoJsonRequest jsonTypeObject
37143>>>>>>>    
37143>>>>>>>    Send SetMemberValue of hoJsonRequest "email"        jsonTypeString  sEmail
37144>>>>>>>    Send SetMemberValue of hoJsonRequest "fix-typos"    jsonTypeBoolean False
37145>>>>>>>    
37145>>>>>>>    Get AddHeader of hoHttp "User-ID" "Henryrl83_" to bRet
37146>>>>>>>    Get AddHeader of hoHttp "API-Key" "bULS6bwuyVRWWKPZjkKPiU5ohIXaU7IQdAZVpr3rReyaotcF" to bRet
37147>>>>>>>    
37147>>>>>>>    Get HttpPostJson of hoHttp "neutrinoapi.net" "/email-validate" hoJsonRequest (&bRet) to hoResponse
37148>>>>>>>    
37148>>>>>>>    
37148>>>>>>>    If (bRet and (ResponseStatusCode(hoHttp) = 200)) Begin
37150>>>>>>>        //Send Info_Box (Stringify(hoResponse)) "La respuesta de NEUTRINO"
37150>>>>>>>        If (HasMember(hoResponse,"valid") and HasMember(hoResponse, "is-disposable")) Begin
37152>>>>>>>            Get IsMemberOfJsonType of hoResponse "valid" jsonTypeNull to bIsnull
37153>>>>>>>            Get IsMemberOfJsonType of hoResponse "is-disposable" jsonTypeNull to bIsnull
37154>>>>>>>            If (bIsnull) Begin
37156>>>>>>>                Function_Return False
37157>>>>>>>            End
37157>>>>>>>>
37157>>>>>>>            Else Begin
37158>>>>>>>                Get MemberValue of hoResponse "valid" to sResponse
37159>>>>>>>                Get MemberValue of hoResponse "is-disposable" to sResponse2
37160>>>>>>>                If ((sResponse = "1") and (sResponse2 = "0")) Begin
37162>>>>>>>                    Function_Return True
37163>>>>>>>                End
37163>>>>>>>>
37163>>>>>>>                Else Begin
37164>>>>>>>                    Move "La sintaxis es correcta. Está bien escrito. Pero el email no está verificado por NEUTRINO" to sMsg
37165>>>>>>>                    Function_Return False
37166>>>>>>>                End
37166>>>>>>>>
37166>>>>>>>            End
37166>>>>>>>>
37166>>>>>>>        End
37166>>>>>>>>
37166>>>>>>>        Move True to bRet
37167>>>>>>>    End
37167>>>>>>>>
37167>>>>>>>    
37167>>>>>>>    Function_Return bRet
37168>>>>>>>End_Function
37169>>>>>
37169>>>>>Open schoolhouse
Including file: schoolhouse.fd    (C:\DataFlex Projects\ColegioAppWeb\DDSrc\schoolhouse.fd)
37171>>>>>Open student
Including file: student.fd    (C:\DataFlex Projects\ColegioAppWeb\DDSrc\student.fd)
37173>>>>>
37173>>>>>Object oValidationCounty is a DescriptionValidationTable
37175>>>>>    Procedure Fill_List
37178>>>>>        Forward Send Fill_List
37180>>>>>        Send Add_Table_Value "Huelva" "HUELVA"
37181>>>>>        Send Add_Table_Value "Sevilla" "SEVILLA"
37182>>>>>        Send Add_Table_Value "Cádiz" "CÁDIZ"
37183>>>>>        Send Add_Table_Value "Málaga" "MÁLAGA"
37184>>>>>        Send Add_Table_Value "Granada" "GRANADA"
37185>>>>>        Send Add_Table_Value "Córdoba" "CÓRDOBA"
37186>>>>>        Send Add_Table_Value "Almería" "ALMERÍA"
37187>>>>>        Send Add_Table_Value "Jaén" "JAÉN"
37188>>>>>    End_Procedure
37189>>>>>End_Object
37190>>>>>
37190>>>>>//registrar la funciones que luego usaremos para validar email
37190>>>>>Register_Function zValidar_Email Integer iField Returns Boolean
37190>>>>>
37190>>>>>Class cschoolhouseDataDictionary is a DataDictionary
37191>>>>>    
37191>>>>>    Procedure Construct_Object
37193>>>>>        Forward Send Construct_Object
37195>>>>>        Set Main_File to schoolhouse.File_Number
37196>>>>>
37196>>>>>        Set Add_Client_File to student.File_Number
37197>>>>>
37197>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_NOPUT to True
37198>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_FINDREQ to True
37199>>>>>        Set Foreign_Field_Option DD_INDEXFIELD DD_NOPUT to True
37200>>>>>        Set Foreign_Field_Option DD_DEFAULT DD_DISPLAYONLY to True
37201>>>>>
37201>>>>>        Set Field_Option Field schoolhouse.ID DD_DISPLAYONLY to True
37202>>>>>        Set Key_Field_State Field schoolhouse.ID to True
37203>>>>>
37203>>>>>        Set Field_Value_Table Field schoolhouse.County to oValidationCounty
37204>>>>>        Set Field_Class_Name Field schoolhouse.County to "Combo"
37205>>>>>
37205>>>>>        Set Field_Option Field schoolhouse.ModifiedTime DD_DISPLAYONLY to True
37206>>>>>
37206>>>>>        Set Field_Option Field schoolhouse.CreatedTime DD_DISPLAYONLY to True
37207>>>>>
37207>>>>>//una vez verificado que el email es correcto se almacena en el campo correspondiente de la bbdd                
37207>>>>>        Set Field_Validate_msg Field schoolhouse.Email to get_zValidar_Email
37208>>>>>
37208>>>>>    End_Procedure
37209>>>>>
37209>>>>>//llamamos a las funciones definidas en los archivos para validar los email
37209>>>>>
37209>>>>>    //llamar a la funcion para validar el email    
37209>>>>>    Function zValidar_Email Integer iField Returns Boolean
37211>>>>>        Boolean bRet
37211>>>>>        String sEmail sMsg
37211>>>>>        
37211>>>>>        Get Field_Current_Value Field schoolhouse.Email to sEmail
37212>>>>>        
37212>>>>>        Get ValidarEmail sEmail (&sMsg) to bRet
37213>>>>>        If (not(bRet)) Begin
37215>>>>>            Send Data_set_error iField DFERR_OPERATOR sMsg
37216>>>>>        End
37216>>>>>>
37216>>>>>        
37216>>>>>        Function_Return (not(bRet))
37217>>>>>    End_Function
37218>>>>>
37218>>>>>End_Class
37219>>>
37219>>>Object oSchoolHouse is a cWebView
37221>>>    Set piColumnCount to 12
37222>>>    Set psCaption to "Colegio"
37223>>>    Set peWebViewStyle to wvsDrilldown
37224>>>    Set peViewType to vtZoom
37225>>>    Set pbShowCaption to False
37226>>>    Set Verify_Save_Msg to 0
37227>>>    Set piMaxWidth to 1024
37228>>>
37228>>>    Object oschoolhouse_DD is a cschoolhouseDataDictionary
37230>>>    End_Object 
37231>>>
37231>>>    Set Main_DD To oschoolhouse_DD
37232>>>    Set Server  To oschoolhouse_DD
37233>>>
37233>>>
37233>>>    Object oWebMainPanel is a cWebPanel
37235>>>        Set piColumnCount to 12
37236>>>        WebSetResponsive piColumnCount rmMobile to 4
37237>>>
37237>>>        /*Object oschoolhouseID is a cWebForm            Entry_Item schoolhouse.ID            Set piColumnSpan to 2            Set piColumnIndex to 0            Set peLabelPosition to lpTop            Set psLabel to "ID"        End_Object*/ 
37237>>>
37237>>>        Object oschoolhouseName is a cWebForm
37239>>>            Entry_Item schoolhouse.Name
37240>>>            Set piColumnSpan to 8
37241>>>            Set piColumnIndex to 0
37242>>>            Set peLabelPosition to lpTop
37243>>>            Set psLabel to "Nombre"
37244>>>        End_Object 
37245>>>
37245>>>        Object oWebTabContainer is a cWebTabContainer
37247>>>            Set pbFillHeight to True
37248>>>            Set piColumnSpan to 12
37249>>>            Set pbShowLabel to False
37250>>>
37250>>>            Object oPage1 is a cWebTabPage
37252>>>                Set piColumnCount to 12
37253>>>                Set psCaption to "Datos de Contacto"
37254>>>
37254>>>                Object oschoolhouseAddress is a cWebForm
37256>>>                    Entry_Item schoolhouse.Address
37257>>>                    Set piColumnSpan to 6
37258>>>                    Set piColumnIndex to 0
37259>>>                    Set peLabelPosition to lpTop
37260>>>                    Set psLabel to "Dirección"
37261>>>                End_Object 
37262>>>                WebSetResponsive piColumnCount rmMobile to 4
37263>>>
37263>>>                Object oschoolhouseCity is a cWebForm
37265>>>                    Entry_Item schoolhouse.City
37266>>>                    Set piColumnSpan to 5
37267>>>                    Set piColumnIndex to 0
37268>>>                    Set peLabelPosition to lpTop
37269>>>                    Set psLabel to "Ciudad"
37270>>>                End_Object 
37271>>>
37271>>>                Object oschoolhouseZipCode is a cWebForm
37273>>>                    Entry_Item schoolhouse.ZipCode
37274>>>                    Set piColumnSpan to 2
37275>>>                    Set piColumnIndex to 5
37276>>>                    Set peLabelPosition to lpTop
37277>>>                    Set psLabel to "C.P"
37278>>>                End_Object 
37279>>>
37279>>>                Object oschoolhouseCounty is a cWebCombo
37281>>>                    Entry_Item schoolhouse.County
37282>>>                    Set piColumnSpan to 2
37283>>>                    Set piColumnIndex to 7
37284>>>                    Set peLabelPosition to lpTop
37285>>>                    Set psLabel to "Provincia"
37286>>>                End_Object 
37287>>>
37287>>>                Object oschoolhouseEmail is a cWebEdit
37289>>>                    Entry_Item schoolhouse.Email
37290>>>                    Set piColumnSpan to 12
37291>>>                    Set piColumnIndex to 0
37292>>>                    Set peLabelPosition to lpTop
37293>>>                    Set psLabel to "Email"
37294>>>                    Set piMinHeight to 150
37295>>>                End_Object 
37296>>>
37296>>>                Object oschoolhouseNotes is a cWebForm
37298>>>                    Entry_Item schoolhouse.Notes
37299>>>                    Set piColumnSpan to 12
37300>>>                    Set piColumnIndex to 0
37301>>>                    Set peLabelPosition to lpTop
37302>>>                    Set psLabel to "Comentarios Añadidos"
37303>>>                End_Object 
37304>>>            End_Object 
37305>>>
37305>>>            Object oPage2 is a cWebTabPage
37307>>>                Set piColumnCount to 12
37308>>>                Set psCaption to "Fecha y Hora Creación/Modificación"
37309>>>                WebSetResponsive piColumnCount rmMobile to 4
37310>>>
37310>>>                Object oschoolhouseModifiedTime is a cWebForm
37312>>>                    Entry_Item schoolhouse.ModifiedTime
37313>>>                    Set piColumnSpan to 6
37314>>>                    Set piColumnIndex to 0
37315>>>                    Set peLabelPosition to lpTop
37316>>>                    Set psLabel to "Fecha y Hora de Modificación"
37317>>>                End_Object 
37318>>>
37318>>>                Object oschoolhouseCreatedTime is a cWebForm
37320>>>                    Entry_Item schoolhouse.CreatedTime
37321>>>                    Set piColumnSpan to 6
37322>>>                    Set piColumnIndex to 0
37323>>>                    Set peLabelPosition to lpTop
37324>>>                    Set psLabel to "Fecha y Hora de Creación"
37325>>>                End_Object 
37326>>>            End_Object 
37327>>>        End_Object 
37328>>>    End_Object 
37329>>>
37329>>>    Object oActionGroup is a cWebMenuGroup
37331>>>
37331>>>        Object oSaveBtn is a cWebMenuItem
37333>>>            Set psCSSClass to "WebSaveMenuItem"
37334>>>            Set psCaption to "Guardar"
37335>>>
37335>>>            Procedure OnClick
37338>>>                Send Request_Save
37339>>>            End_Procedure
37340>>>
37340>>>        End_Object 
37341>>>
37341>>>        Object oEditBtn is a cWebMenuItem
37343>>>            Set psCSSClass to "WebEditMenuItem"
37344>>>            Set psCaption to "Editar"
37345>>>            Procedure OnClick
37348>>>                Send ChangeEditMode True
37349>>>                Send SetActionButtons
37350>>>            End_Procedure
37351>>>
37351>>>        End_Object 
37352>>>
37352>>>        Object oDeleteBtn is a cWebMenuItem
37354>>>            Set psCSSClass to "WebDeleteMenuItem"
37355>>>            Set psCaption to "Borrar"
37356>>>            Set peActionDisplay to adMenu
37357>>>
37357>>>            Procedure OnClick
37360>>>                Send Request_Delete
37361>>>            End_Procedure
37362>>>
37362>>>        End_Object 
37363>>>
37363>>>        Object oCancelChangesBtn is a cWebMenuItem
37365>>>            Set psCSSClass to "WebIcon_Refresh"
37366>>>            Set psCaption to "Limpiar Cambios"
37367>>>            Set peActionDisplay to adMenu
37368>>>            Procedure OnClick
37371>>>                Send RefreshRecord
37372>>>            End_Procedure
37373>>>
37373>>>        End_Object 
37374>>>    End_Object 
37375>>>
37375>>>    Procedure SetActionButtons
37378>>>        tWebNavigateData NavigateData
37378>>>        tWebNavigateData NavigateData
37378>>>        Boolean bHasRecord
37378>>>        Handle hoDD
37378>>>
37378>>>        Get Server to hoDD
37379>>>        Get GetNavigateData to NavigateData
37380>>>        Get HasRecord of hoDD to bHasRecord
37381>>>
37381>>>        // let's hide all buttons and then Show the ones we want
37381>>>        WebSet pbRender of oEditBtn to False
37382>>>        WebSet pbRender of oSaveBtn to False
37383>>>        WebSet pbRender of oCancelChangesBtn to False
37384>>>        WebSet pbRender of oDeleteBtn to False
37385>>>
37385>>>        If (NavigateData.bReadOnly) Begin
37387>>>            WebSet pbRender of oEditBtn to True
37388>>>        End
37388>>>>
37388>>>        Else Begin
37389>>>            WebSet pbRender of oSaveBtn to True
37390>>>            WebSet pbRender of oCancelChangesBtn to True
37391>>>            WebSet pbRender of oDeleteBtn to bHasRecord
37392>>>        End
37392>>>>
37392>>>    End_Procedure
37393>>>
37393>>>    Procedure OnViewSaved Handle hoServer Boolean bChanged
37396>>>        // Close after save
37396>>>        Send NavigateClose Self
37397>>>    End_Procedure
37398>>>
37398>>>    // this will close the view after a delete
37398>>>    Procedure OnViewDeleted Handle hoDDO
37401>>>        Send NavigateClose Self
37402>>>    End_Procedure
37403>>>
37403>>>    Procedure OnNavigateForward tWebNavigateData NavigateData Integer hoInvokingView Integer hoInvokingObject
37406>>>        Case Begin
37406>>>            Case (NavigateData.eNavigateType = nfFromMain)
37408>>>                // If from main, this is a propbably a main file Select to Zoom.
37408>>>                Case Break
37409>>>
37409>>>            Case (NavigateData.eNavigateType = nfFromParent)
37412>>>                // If from parent, this is a constrained drill down.
37412>>>                Case Break
37413>>>
37413>>>            Case (NavigateData.eNavigateType = nfFromChild)
37416>>>                // If from child, this is a probably a parent Zoom from a Zoom.
37416>>>                Case Break
37417>>>
37417>>>            Case Else // must be nfUndefined
37417>>>
37417>>>        Case End
37417>>>
37417>>>        Send SetActionButtons
37418>>>
37418>>>    End_Procedure
37419>>>
37419>>>End_Object 
37420>    Use SelectSchoolHouse.wo
Including file: SelectSchoolHouse.wo    (C:\DataFlex Projects\ColegioAppWeb\AppSrc\SelectSchoolHouse.wo)
37420>>>// C:\DataFlex Projects\ColegioAppWeb\AppSrc\SelectSchoolHouse.wo
37420>>>// SchoolHouse
37420>>>//
37420>>>
37420>>>Use cWebView.pkg
37420>>>Use cWebList.pkg
37420>>>Use cWebMenuGroup.pkg
37420>>>Use cWebMenuItem.pkg
37420>>>Use cWebColumnButton.pkg
37420>>>Use cWebColumn.pkg
37420>>>Use SchoolHouse.wo
37420>>>
37420>>>Use cschoolhouseDataDictionary.dd
37420>>>
37420>>>Object oSelectSchoolHouse is a cWebView
37422>>>    Set psCaption to "COLEGIOS"
37423>>>    Set peWebViewStyle to wvsDrilldown
37424>>>    Set peViewType to vtSelect
37425>>>    Set piColumnCount to 12
37426>>>    Set pbShowCaption to True
37427>>>    Set piMaxWidth to 1024
37428>>>
37428>>>    Object oschoolhouse_DD is a cschoolhouseDataDictionary
37430>>>    End_Object 
37431>>>
37431>>>    Set Main_DD To oschoolhouse_DD
37432>>>    Set Server  To oschoolhouse_DD
37433>>>
37433>>>
37433>>>    Object oList is a cWebList
37435>>>        Set piColumnSpan to 12
37436>>>        Set psCSSClass to "MobileList"
37437>>>        Set pbServerOnRowClick to True
37438>>>        Set pbFillHeight to True
37439>>>        Set pbShowHeader to False
37440>>>        Set piSortColumn to 0
37441>>>
37441>>>        /*Object oschoolhouseID is a cWebColumn            Entry_Item schoolhouse.ID            Set psCaption to "schoolhouse.ID"            Set piWidth to 124            Set piListColSpan to 2        End_Object*/
37441>>>
37441>>>        Object oDetailButton is a cWebColumnButton
37443>>>            Set psCaption to "btn"
37444>>>            Set piWidth to 45
37445>>>            Set pbFixedWidth to True
37446>>>            Set pbResizable to False
37447>>>            Set piListRowSpan to 8
37448>>>            Set psBtnCssClass to "WebButtonIcon WebIcon_Info"
37449>>>            Set peAlign to alignRight
37450>>>            Set pbShowCaption to False
37451>>>            Set pbHidden to True
37452>>>
37452>>>            WebRegisterPath ntNavigateForward oSchoolHouse
37458>>>
37458>>>            Procedure OnClick
37461>>>                Send NavigatePath
37462>>>            End_Procedure
37463>>>
37463>>>            Procedure OnGetNavigateForwardData tWebNavigateData ByRef NavigateData Handle hoToView
37466>>>                Move True to NavigateData.bReadOnly
37467>>>            End_Procedure
37468>>>
37468>>>        End_Object 
37469>>>
37469>>>        Object oschoolhouseName is a cWebColumn
37471>>>            Entry_Item schoolhouse.Name
37472>>>            Set psCaption to "schoolhouse.Name"
37473>>>            Set piWidth to 494
37474>>>            Set psCSSClass to "RowCaption"
37475>>>        End_Object 
37476>>>
37476>>>        Object oschoolhouseCity is a cWebColumn
37478>>>            Entry_Item schoolhouse.City
37479>>>            Set psCaption to "schoolhouse.City"
37480>>>            Set piWidth to 505
37481>>>            Set psCSSClass to "RowCaption"
37482>>>        End_Object 
37483>>>
37483>>>        Object oschoolhouseCounty is a cWebColumn
37485>>>            Entry_Item schoolhouse.County
37486>>>            Set psCaption to "schoolhouse.County"
37487>>>            Set piWidth to 281
37488>>>            Set psCSSClass to "RowCaption"
37489>>>            Set pbNewLine to True
37490>>>        End_Object 
37491>>>
37491>>>        Object oschoolhouseEmail is a cWebColumn
37493>>>            Entry_Item schoolhouse.Email
37494>>>            Set psCaption to "schoolhouse.Email"
37495>>>            Set piWidth to 345
37496>>>            Set psCSSClass to "RowCaption"
37497>>>        End_Object 
37498>>>
37498>>>        WebRegisterPath ntNavigateForward oSchoolHouse
37504>>>
37504>>>        Procedure OnRowClick String sRowId
37507>>>            tWebNavigateData NavigateData
37507>>>            tWebNavigateData NavigateData
37507>>>            Get GetNavigateData to NavigateData
37508>>>
37508>>>            Case Begin
37508>>>                Case (NavigateData.eNavigateType = nfFromParent)
37510>>>                    Send NavigateForward of oSchoolHouse Self
37511>>>                    Case Break
37512>>>
37512>>>                Case (NavigateData.eNavigateType = nfFromChild)
37515>>>                    Send NavigateClose Self
37516>>>                    Case Break
37517>>>
37517>>>                Case (NavigateData.eNavigateType = nfFromMain)
37520>>>                    Send NavigateClose Self
37521>>>                    Case Break
37522>>>                    
37522>>>                Case Else // must be nfUndefined
37522>>>                    Send NavigateForward of oSchoolHouse Self
37523>>>            Case End
37523>>>        End_Procedure
37524>>>
37524>>>        Procedure OnGetNavigateForwardData tWebNavigateData ByRef NavigateData Handle hoToView
37527>>>            Move True to NavigateData.bReadOnly
37528>>>        End_Procedure
37529>>>
37529>>>    End_Object 
37530>>>
37530>>>    Object oActionGroup is a cWebMenuGroup
37532>>>
37532>>>        Object oSearch is a cWebMenuItem
37534>>>            Set psCSSClass to "WebPromptMenuItem"
37535>>>            Set psCaption to "Buscar"
37536>>>
37536>>>            Procedure OnClick
37539>>>                Send Search of oList
37540>>>            End_Procedure
37541>>>
37541>>>        End_Object 
37542>>>
37542>>>        Object oNewButton is a cWebMenuItem
37544>>>            Set psCSSClass to "WebClearMenuItem"
37545>>>            Set psCaption to "Nuevo"
37546>>>
37546>>>            WebRegisterPath ntNavigateForward oSchoolHouse
37552>>>
37552>>>            Procedure OnClick
37555>>>                Send NavigatePath
37556>>>            End_Procedure
37557>>>
37557>>>            Procedure OnGetNavigateForwardData tWebNavigateData ByRef NavigateData Handle hoToView
37560>>>                Move True to NavigateData.bNewRecord
37561>>>            End_Procedure
37562>>>
37562>>>        End_Object 
37563>>>    End_Object 
37564>>>
37564>>>    Procedure OnNavigateForward tWebNavigateData NavigateData Integer hoInvokingView Integer hoInvokingObject
37567>>>        WebSet pbRender of oNewButton to True
37568>>>        WebSet pbRender of oDetailButton to True
37569>>>
37569>>>        Case Begin
37569>>>            Case (NavigateData.eNavigateType = nfFromParent)
37571>>>                // If from parent, this is a constrained drill down
37571>>>                Case Break
37572>>>
37572>>>            Case (NavigateData.eNavigateType = nfFromChild)
37575>>>                // If from child, this is a probably a parent lookup from a Zoom
37575>>>                Case Break
37576>>>
37576>>>            Case (NavigateData.eNavigateType = nfFromMain)
37579>>>                // If from main, this is a probably a main-file lookup from a Zoom
37579>>>                WebSet pbRender of oDetailButton to False
37580>>>                Case Break
37581>>>
37581>>>            Case Else // must be nfUndefined
37581>>>                // This may be the start of a drilldown query or this may be used for some kind of custom query.
37581>>>
37581>>>        Case End
37581>>>
37581>>>    End_Procedure
37582>>>
37582>>>
37582>>>End_Object 
37583>    Use Student.wo
Including file: Student.wo    (C:\DataFlex Projects\ColegioAppWeb\AppSrc\Student.wo)
37583>>>// C:\DataFlex Projects\ColegioAppWeb\AppSrc\Student.wo
37583>>>// Alumno
37583>>>//
37583>>>
37583>>>Use cWebView.pkg
37583>>>Use cWebPanel.pkg
37583>>>Use cWebMenuGroup.pkg
37583>>>Use cWebMenuItem.pkg
37583>>>Use cWebForm.pkg
37583>>>Use cWebTabContainer.pkg
37583>>>Use cWebTabPage.pkg
37583>>>Use cWebEdit.pkg
37583>>>
37583>>>Use cschoolhouseDataDictionary.dd
37583>>>Use cstudentDataDictionary.dd
Including file: cstudentDataDictionary.dd    (C:\DataFlex Projects\ColegioAppWeb\DDSrc\cstudentDataDictionary.dd)
37583>>>>>Use DataDict.pkg
37583>>>>>
37583>>>>>//importar los archivos donde tenemos las funciones principales de validacion
37583>>>>>Use ValidarDNI.pkg
Including file: ValidarDNI.pkg    (C:\DataFlex Projects\ColegioAppWeb\AppSrc\ValidarDNI.pkg)
37583>>>>>>>Define cLetter for "TRWAGMYFPDXBNJZSQVHLCKE"
37583>>>>>>>Define cNumber for "0123456789"
37583>>>>>>>
37583>>>>>>>//-------------------------------------------
37583>>>>>>>Function ValidacionDNI String sDNI String ByRef sMsg Returns Boolean
37586>>>>>>>    //Convertir en mayúsculas todo lo contenido en la cadena sDNI
37586>>>>>>>    Move (Uppercase(sDNI)) to sDNI
37587>>>>>>>    
37587>>>>>>>    //crea la variable boleana para usarla en la funciones internas de esta función principal
37587>>>>>>>    Boolean bRet
37587>>>>>>>   
37587>>>>>>>    //------------ comprobación de entrada VACÍA
37587>>>>>>>    If (sDNI="") Begin
37589>>>>>>>        Move "Tienes que introducir algo" to sMsg
37590>>>>>>>        Function_Return False
37591>>>>>>>    End
37591>>>>>>>>
37591>>>>>>>
37591>>>>>>>    //-----------------comprobación de LONGITUD de la cadena
37591>>>>>>>    Get DNILen sDNI (&sMsg) to bRet
37592>>>>>>>    
37592>>>>>>>    If (not(bRet)) Begin
37594>>>>>>>        Move "La longitud no es correcta, TIENE QUE TENER 9 DIGITOS" to sMsg
37595>>>>>>>        Function_Return False
37596>>>>>>>    End
37596>>>>>>>>
37596>>>>>>>   
37596>>>>>>>    //-----------------comprobacion de que el último digito es una letra
37596>>>>>>>    Get DNILastChar sDNI (&sMsg) to bRet
37597>>>>>>>    
37597>>>>>>>    If (not(bRet)) Begin
37599>>>>>>>        Move "El último digito tiene que ser una LETRA válida" to sMsg
37600>>>>>>>        Function_Return False
37601>>>>>>>    End
37601>>>>>>>>
37601>>>>>>>    
37601>>>>>>>    //------------------comprobación 8 primeros sean digitos
37601>>>>>>>    Get SinCaracteres sDNI (&sMsg) to bRet
37602>>>>>>>    
37602>>>>>>>    If (not(bRet)) Begin
37604>>>>>>>        Move "Si es un DNI los 8 primeros dígitos tienen que ser números. Si es un NIE la primera letra debe ser X, Y,o Z" to sMsg
37605>>>>>>>        Function_Return False
37606>>>>>>>    End
37606>>>>>>>>
37606>>>>>>>    
37606>>>>>>>    //------------------ comprobación de letra correspondiente
37606>>>>>>>    Get CalcularLetraDNI sDNI (&sMsg) to bRet
37607>>>>>>>    
37607>>>>>>>        If (not(bRet)) Begin
37609>>>>>>>        Move "El NIF/NIE no es válido" to sMsg
37610>>>>>>>        Function_Return False
37611>>>>>>>        End
37611>>>>>>>>
37611>>>>>>>        
37611>>>>>>>    //--------------------
37611>>>>>>>     
37611>>>>>>>    Function_Return True
37612>>>>>>>End_Function
37613>>>>>>>
37613>>>>>>>//-----------------------------------------------longitud del dni introducido
37613>>>>>>>Function DNILen String sDNI String ByRef sMsg Returns Boolean
37616>>>>>>>    Integer iLen
37616>>>>>>>    //-------------
37616>>>>>>>    Move (Length(sDNI)) to iLen
37617>>>>>>>    
37617>>>>>>>    If (iLen <> 9) Begin
37619>>>>>>>        Function_Return False
37620>>>>>>>    End
37620>>>>>>>>
37620>>>>>>>    //--------------
37620>>>>>>>    Function_Return True    
37621>>>>>>>End_Function
37622>>>>>>>
37622>>>>>>>
37622>>>>>>>//---------------------------------------------------última digito letra valida
37622>>>>>>>Function DNILastChar String sDNI String ByRef sMsg Returns Boolean
37625>>>>>>>    Integer iCount
37625>>>>>>>    String sChar sCharCadena
37625>>>>>>>    
37625>>>>>>>    Move (Right(sDNI,1)) to sChar
37626>>>>>>>    For iCount from 1 to (Length(cLetter))
37632>>>>>>>>
37632>>>>>>>        Move (Mid(cLetter,1,iCount)) to sCharCadena
37633>>>>>>>        If (sChar=sCharCadena) Begin
37635>>>>>>>            Function_Return True            
37636>>>>>>>        End
37636>>>>>>>>
37636>>>>>>>    Loop
37637>>>>>>>>
37637>>>>>>>    Function_Return False    
37638>>>>>>>End_Function
37639>>>>>>>
37639>>>>>>>
37639>>>>>>>//-------------------------------------------------------comprueba si hay letras entre los 8 primeros dígitos
37639>>>>>>>Function SinCaracteres String sDNI String ByRef sMsg Returns Boolean
37642>>>>>>>    Integer iCount iCount2
37642>>>>>>>    String sValue sDig sComprobado
37642>>>>>>>    Boolean bRet
37642>>>>>>>
37642>>>>>>>    Move (Left(sDNI,8)) to sValue    
37643>>>>>>>    // Convertir X, Y, Z a 0, 1, 2
37643>>>>>>>        
37643>>>>>>>    If (Left(sValue, 1) = "X") Begin
37645>>>>>>>        Move (Replace("X",sValue, "0")) to sValue
37646>>>>>>>    End
37646>>>>>>>>
37646>>>>>>>    If (Left(sValue, 1) = "Y") Begin
37648>>>>>>>        Move (Replace("Y", sValue, "1")) to sValue
37649>>>>>>>    End
37649>>>>>>>>
37649>>>>>>>    If (Left(sValue, 1) = "Z") Begin
37651>>>>>>>        Move (Replace("Z", sValue, "2")) to sValue
37652>>>>>>>    End
37652>>>>>>>>
37652>>>>>>>    //------------------contador para ver si hay caracteres en la cadena numerica
37652>>>>>>>    For iCount from 1 to (Length(sValue))
37658>>>>>>>>
37658>>>>>>>        Move False to bRet
37659>>>>>>>        Move (Mid(sValue, 1, iCount)) to sDig
37660>>>>>>>        For iCount2 from 1 to (Length(cNumber))
37666>>>>>>>>
37666>>>>>>>            Move (Mid(cNumber, 1, iCount2)) to sComprobado
37667>>>>>>>            If (sDig=sComprobado) Begin
37669>>>>>>>                Move True to bRet
37670>>>>>>>            End
37670>>>>>>>>
37670>>>>>>>        Loop
37671>>>>>>>>
37671>>>>>>>        If (not(bRet)) Begin
37673>>>>>>>            Function_Return False        
37674>>>>>>>        End
37674>>>>>>>>
37674>>>>>>>    Loop
37675>>>>>>>>
37675>>>>>>>    
37675>>>>>>>    Function_Return True    
37676>>>>>>>End_Function
37677>>>>>>>
37677>>>>>>>
37677>>>>>>>//-------------------------------------------------------calcula letra DNI
37677>>>>>>>Function CalcularLetraDNI String sDNI String ByRef sMsg Returns Boolean
37680>>>>>>>    Integer iDNI iResto
37680>>>>>>>    String sLetter sChar
37680>>>>>>>    
37680>>>>>>>    // Convertir X, Y, Z a 0, 1, 2        
37680>>>>>>>    If (Left(sDNI, 1) = "X") Begin
37682>>>>>>>        Move (Replace("X",sDNI, "0")) to sDNI
37683>>>>>>>    End
37683>>>>>>>>
37683>>>>>>>    If (Left(sDNI, 1) = "Y") Begin
37685>>>>>>>        Move (Replace("Y", sDNI, "1")) to sDNI
37686>>>>>>>    End
37686>>>>>>>>
37686>>>>>>>    If (Left(sDNI, 1) = "Z") Begin
37688>>>>>>>        Move (Replace("Z", sDNI, "2")) to sDNI
37689>>>>>>>    End
37689>>>>>>>>
37689>>>>>>>
37689>>>>>>>    //-----------------------------------------asignar la letra al resto de la división
37689>>>>>>>    Move (Right(sDNI, 1)) to sChar 
37690>>>>>>>    Move (Left(sDNI,8)) to iDNI
37691>>>>>>>    Move (Mod(iDNI, 23)) to iResto
37692>>>>>>>    Move (Mid(cLetter, 1, (iResto + 1))) to sLetter
37693>>>>>>>    
37693>>>>>>>    // Asignar la letra correspondiente
37693>>>>>>>     If (sChar = sLetter) Begin
37695>>>>>>>        Function_Return True
37696>>>>>>>    End
37696>>>>>>>>
37696>>>>>>>  
37696>>>>>>>    Function_Return False
37697>>>>>>>End_Function
37698>>>>>Use ValidarEmail.pkg
37698>>>>>
37698>>>>>Open student
37700>>>>>Open schoolhouse
37702>>>>>
37702>>>>>Object oValidationCounty is a DescriptionValidationTable
37704>>>>>    Procedure Fill_List
37707>>>>>        Forward Send Fill_List
37709>>>>>        Send Add_Table_Value "Huelva" "HUELVA"
37710>>>>>        Send Add_Table_Value "Sevilla" "SEVILLA"
37711>>>>>        Send Add_Table_Value "Málaga" "MÁLAGA"
37712>>>>>        Send Add_Table_Value "Cadiz" "CÁDIZ"
37713>>>>>        Send Add_Table_Value "Córdoba" "CÓRDOBA"
37714>>>>>        Send Add_Table_Value "Jaén" "JAÉN"
37715>>>>>        Send Add_Table_Value "Almería" "ALMERÍA"
37716>>>>>        Send Add_Table_Value "Granada" "GRANADA"
37717>>>>>    End_Procedure
37718>>>>>End_Object
37719>>>>>
37719>>>>>//registrar las funciones que luego usaremos para validar email y dni
37719>>>>>Register_Function zValidar_Email Integer iField Returns Boolean
37719>>>>>Register_Function zValidar_Dni Integer iField   Returns Boolean
37719>>>>>
37719>>>>>Class cstudentDataDictionary is a DataDictionary
37720>>>>>    
37720>>>>>    Procedure Construct_Object
37722>>>>>        Forward Send Construct_Object
37724>>>>>        Set Main_File to student.File_Number
37725>>>>>
37725>>>>>        Set Add_Server_File to schoolhouse.File_Number
37726>>>>>
37726>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_NOPUT to True
37727>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_FINDREQ to True
37728>>>>>        Set Foreign_Field_Option DD_INDEXFIELD DD_NOPUT to True
37729>>>>>        Set Foreign_Field_Option DD_DEFAULT DD_DISPLAYONLY to True
37730>>>>>
37730>>>>>        Set Key_Field_State Field student.ID to True
37731>>>>>        Set Field_Option Field student.ID DD_DISPLAYONLY to True
37732>>>>>
37732>>>>>        Set Field_Option Field student.ModifiedTime DD_DISPLAYONLY to True
37733>>>>>
37733>>>>>        Set Field_Option Field student.CreatedTime DD_DISPLAYONLY to True
37734>>>>>
37734>>>>>//una vez verificado que el email y el dni son correctos se almacena en el campo correspondiente de la bbdd        
37734>>>>>        Set Field_Validate_msg Field student.Email to get_zValidar_Email
37735>>>>>
37735>>>>>        Set Field_Mask_Type Field student.County to Mask_DateTime_Window
37736>>>>>        Set Field_Value_Table Field student.County to oValidationCounty
37737>>>>>        Set Field_Validate_msg Field student.DNI to   get_zValidar_Dni
37738>>>>>
37738>>>>>    End_Procedure
37739>>>>>
37739>>>>>//llamamos a las funciones definidas en los archivos para validar los email y dni
37739>>>>>
37739>>>>>    //llamar a la funcion para validar el email
37739>>>>>    Function zValidar_Email Integer iField Returns Boolean
37741>>>>>        Boolean bRet
37741>>>>>        String sEmail sMsg
37741>>>>>        
37741>>>>>        Get Field_Current_Value Field student.Email to sEmail
37742>>>>>        Get ValidarEmail sEmail (&sMsg) to bRet
37743>>>>>        If (not(bRet)) Begin
37745>>>>>            Send Data_set_error iField DFERR_OPERATOR sMsg
37746>>>>>        End
37746>>>>>>
37746>>>>>        
37746>>>>>        Function_Return (not(bRet))
37747>>>>>        End_Function
37748>>>>>
37748>>>>>    //llamar a la funcion para validar el dni    
37748>>>>>    Function zValidar_Dni Integer iField Returns Boolean
37750>>>>>        Boolean bRet
37750>>>>>        String sDni sMsg
37750>>>>>        
37750>>>>>        Get Field_Current_Value Field student.DNI to sDni
37751>>>>>        Get ValidacionDNI sDni (&sMsg) to bRet
37752>>>>>        If (not(bRet)) Begin
37754>>>>>            Send Data_set_error iField DFERR_OPERATOR sMsg
37755>>>>>        End
37755>>>>>>
37755>>>>>        
37755>>>>>        Function_Return (not(bRet))
37756>>>>>    End_Function
37757>>>>>
37757>>>>>End_Class
37758>>>
37758>>>Object oStudent is a cWebView
37760>>>    Set piColumnCount to 12
37761>>>    Set psCaption to "Alumno"
37762>>>    Set peWebViewStyle to wvsDrilldown
37763>>>    Set peViewType to vtZoom
37764>>>    Set pbShowCaption to False
37765>>>    Set Verify_Save_Msg to 0
37766>>>    Set piMaxWidth to 1024
37767>>>
37767>>>    Object oschoolhouse_DD is a cschoolhouseDataDictionary
37769>>>    End_Object 
37770>>>
37770>>>    Object ostudent_DD is a cstudentDataDictionary
37772>>>        Set DDO_Server To oschoolhouse_DD
37773>>>    End_Object 
37774>>>
37774>>>    Set Main_DD To ostudent_DD
37775>>>    Set Server  To ostudent_DD
37776>>>
37776>>>
37776>>>    Object oWebMainPanel is a cWebPanel
37778>>>        Set piColumnCount to 12
37779>>>        WebSetResponsive piColumnCount rmMobile to 4
37780>>>
37780>>>        /*Object ostudentID is a cWebForm            Entry_Item student.ID            Set piColumnSpan to 2            Set piColumnIndex to 0            Set peLabelPosition to lpTop            Set psLabel to "ID"        End_Object*/
37780>>>
37780>>>        Object ostudentName is a cWebForm
37782>>>            Entry_Item student.Name
37783>>>            Set piColumnSpan to 4
37784>>>            Set piColumnIndex to 0
37785>>>            Set peLabelPosition to lpTop
37786>>>            Set psLabel to "Nombre"
37787>>>        End_Object 
37788>>>
37788>>>        Object ostudentLastName is a cWebForm
37790>>>            Entry_Item student.LastName
37791>>>            Set piColumnSpan to 6
37792>>>            Set piColumnIndex to 4
37793>>>            Set peLabelPosition to lpTop
37794>>>            Set psLabel to "Apellidos"
37795>>>        End_Object 
37796>>>
37796>>>        Object ostudentBirthday is a cWebDateForm
37798>>>            Entry_Item student.Birthday
37799>>>            Set piColumnSpan to 2
37800>>>            Set piColumnIndex to 0
37801>>>            Set peLabelPosition to lpTop
37802>>>            Set psLabel to "Fecha de Nacimiento"
37803>>>        End_Object 
37804>>>
37804>>>        Object oWebTabContainer is a cWebTabContainer
37806>>>            Set pbFillHeight to True
37807>>>            Set piColumnSpan to 12
37808>>>            Set pbShowLabel to False
37809>>>
37809>>>            Object oPage1 is a cWebTabPage
37811>>>                Set piColumnCount to 12
37812>>>                Set psCaption to "Datos de Contacto"
37813>>>                WebSetResponsive piColumnCount rmMobile to 4
37814>>>
37814>>>                Object ostudentDNI is a cWebForm
37816>>>                    Entry_Item student.DNI
37817>>>                    Set piColumnSpan to 2
37818>>>                    Set piColumnIndex to 0
37819>>>                    Set peLabelPosition to lpTop
37820>>>                    Set psLabel to "DNI"
37821>>>                End_Object 
37822>>>
37822>>>                Object ostudentEmail is a cWebEdit
37824>>>                    Entry_Item student.Email
37825>>>                    Set piColumnSpan to 0
37826>>>                    Set piColumnIndex to 0
37827>>>                    Set peLabelPosition to lpTop
37828>>>                    Set psLabel to "Email"
37829>>>                    Set piMinHeight to 150
37830>>>                End_Object 
37831>>>
37831>>>                Object ostudentCounty is a cWebCombo
37833>>>                    Entry_Item student.County
37834>>>                    Set piColumnSpan to 4
37835>>>                    Set piColumnIndex to 0
37836>>>                    Set peLabelPosition to lpTop
37837>>>                    Set psLabel to "Provincia"
37838>>>                End_Object 
37839>>>
37839>>>                Object ostudentCity is a cWebForm
37841>>>                    Entry_Item student.City
37842>>>                    Set piColumnSpan to 7
37843>>>                    Set piColumnIndex to 4
37844>>>                    Set peLabelPosition to lpTop
37845>>>                    Set psLabel to "Ciudad"
37846>>>                End_Object 
37847>>>
37847>>>                Object ostudentAddress is a cWebForm
37849>>>                    Entry_Item student.Address
37850>>>                    Set piColumnSpan to 10
37851>>>                    Set piColumnIndex to 0
37852>>>                    Set peLabelPosition to lpTop
37853>>>                    Set psLabel to "Dirección"
37854>>>                End_Object 
37855>>>
37855>>>                /*Object oschoolhouseID is a cWebForm                    Entry_Item schoolhouse.ID                    Set piColumnSpan to 3                    Set piColumnIndex to 0                    Set peLabelPosition to lpTop                    Set psLabel to "SchoolHouseID"                    Set pbPromptButton to True                    WebRegisterPath ntNavigateForward oSchoolHouse                    Procedure OnPrompt                        Send NavigatePath                    End_Procedure                End_Object*/ 
37855>>>            End_Object 
37856>>>
37856>>>            Object oPage3 is a cWebTabPage
37858>>>                Set piColumnCount to 12
37859>>>                Set psCaption to "Colegio"
37860>>>                WebSetResponsive piColumnCount rmMobile to 4
37861>>>
37861>>>                /*Object oschoolhouseID is a cWebForm                    Entry_Item schoolhouse.ID                    Set piColumnSpan to 3                    Set piColumnIndex to 0                    Set peLabelPosition to lpTop                    Set psLabel to "ID"                    Set pbPromptButton to False                    WebRegisterPath ntNavigateForward oSelectSchoolHouse                    Procedure OnPrompt                        Send NavigatePath                    End_Procedure                End_Object*/ 
37861>>>
37861>>>                Object oschoolhouseName is a cWebForm
37863>>>                    Entry_Item schoolhouse.Name
37864>>>                    Set piColumnSpan to 6
37865>>>                    Set piColumnIndex to 0
37866>>>                    Set peLabelPosition to lpTop
37867>>>                    Set psLabel to "Nombre"
37868>>>                    Set pbPromptButton to True
37869>>>
37869>>>                    WebRegisterPath ntNavigateForward oSelectSchoolHouse
37875>>>
37875>>>                    Procedure OnPrompt
37878>>>                        Send NavigatePath
37879>>>                    End_Procedure
37880>>>                End_Object 
37881>>>
37881>>>                Object oschoolhouseEmail is a cWebEdit
37883>>>                    Entry_Item schoolhouse.Email
37884>>>                    Set piColumnSpan to 0
37885>>>                    Set piColumnIndex to 0
37886>>>                    Set peLabelPosition to lpTop
37887>>>                    Set psLabel to "Email"
37888>>>                    Set piMinHeight to 150
37889>>>                End_Object 
37890>>>            End_Object 
37891>>>
37891>>>            Object oPage2 is a cWebTabPage
37893>>>                Set piColumnCount to 12
37894>>>                Set psCaption to "Otros"
37895>>>                WebSetResponsive piColumnCount rmMobile to 4
37896>>>
37896>>>                Object ostudentNotes is a cWebForm
37898>>>                    Entry_Item student.Notes
37899>>>                    Set piColumnSpan to 12
37900>>>                    Set piColumnIndex to 0
37901>>>                    Set peLabelPosition to lpTop
37902>>>                    Set psLabel to "Comentarios añadidos"
37903>>>                End_Object 
37904>>>
37904>>>                /*Object ostudentModifiedTime is a cWebForm                    Entry_Item student.ModifiedTime                    Set piColumnSpan to 6                    Set piColumnIndex to 0                    Set peLabelPosition to lpTop                    Set psLabel to "Fecha y hora de modificación"                End_Object                 Object ostudentCreatedTime is a cWebForm                    Entry_Item student.CreatedTime                    Set piColumnSpan to 6                    Set piColumnIndex to 0                    Set peLabelPosition to lpTop                    Set psLabel to "Fecha y hora de Creación"                End_Object*/ 
37904>>>            End_Object 
37905>>>        End_Object 
37906>>>    End_Object 
37907>>>
37907>>>    Object oActionGroup is a cWebMenuGroup
37909>>>
37909>>>        Object oSaveBtn is a cWebMenuItem
37911>>>            Set psCSSClass to "WebSaveMenuItem"
37912>>>            Set psCaption to "Guardar"
37913>>>
37913>>>            Procedure OnClick
37916>>>                Send Request_Save
37917>>>            End_Procedure
37918>>>
37918>>>        End_Object 
37919>>>
37919>>>        Object oEditBtn is a cWebMenuItem
37921>>>            Set psCSSClass to "WebEditMenuItem"
37922>>>            Set psCaption to "Editar"
37923>>>            Procedure OnClick
37926>>>                Send ChangeEditMode True
37927>>>                Send SetActionButtons
37928>>>            End_Procedure
37929>>>
37929>>>        End_Object 
37930>>>
37930>>>        Object oDeleteBtn is a cWebMenuItem
37932>>>            Set psCSSClass to "WebDeleteMenuItem"
37933>>>            Set psCaption to "Borrar"
37934>>>            Set peActionDisplay to adMenu
37935>>>
37935>>>            Procedure OnClick
37938>>>                Send Request_Delete
37939>>>            End_Procedure
37940>>>
37940>>>        End_Object 
37941>>>
37941>>>        Object oCancelChangesBtn is a cWebMenuItem
37943>>>            Set psCSSClass to "WebIcon_Refresh"
37944>>>            Set psCaption to "Limpiar Cambios"
37945>>>            Set peActionDisplay to adMenu
37946>>>            Procedure OnClick
37949>>>                Send RefreshRecord
37950>>>            End_Procedure
37951>>>
37951>>>        End_Object 
37952>>>    End_Object 
37953>>>
37953>>>    Procedure SetActionButtons
37956>>>        tWebNavigateData NavigateData
37956>>>        tWebNavigateData NavigateData
37956>>>        Boolean bHasRecord
37956>>>        Handle hoDD
37956>>>
37956>>>        Get Server to hoDD
37957>>>        Get GetNavigateData to NavigateData
37958>>>        Get HasRecord of hoDD to bHasRecord
37959>>>
37959>>>        // let's hide all buttons and then Show the ones we want
37959>>>        WebSet pbRender of oEditBtn to False
37960>>>        WebSet pbRender of oSaveBtn to False
37961>>>        WebSet pbRender of oCancelChangesBtn to False
37962>>>        WebSet pbRender of oDeleteBtn to False
37963>>>
37963>>>        If (NavigateData.bReadOnly) Begin
37965>>>            WebSet pbRender of oEditBtn to True
37966>>>        End
37966>>>>
37966>>>        Else Begin
37967>>>            WebSet pbRender of oSaveBtn to True
37968>>>            WebSet pbRender of oCancelChangesBtn to True
37969>>>            WebSet pbRender of oDeleteBtn to bHasRecord
37970>>>        End
37970>>>>
37970>>>    End_Procedure
37971>>>
37971>>>    Procedure OnViewSaved Handle hoServer Boolean bChanged
37974>>>        // Close after save
37974>>>        Send NavigateClose Self
37975>>>    End_Procedure
37976>>>
37976>>>    // this will close the view after a delete
37976>>>    Procedure OnViewDeleted Handle hoDDO
37979>>>        Send NavigateClose Self
37980>>>    End_Procedure
37981>>>
37981>>>    Procedure OnNavigateForward tWebNavigateData NavigateData Integer hoInvokingView Integer hoInvokingObject
37984>>>        Case Begin
37984>>>            Case (NavigateData.eNavigateType = nfFromMain)
37986>>>                // If from main, this is a propbably a main file Select to Zoom.
37986>>>                Case Break
37987>>>
37987>>>            Case (NavigateData.eNavigateType = nfFromParent)
37990>>>                // If from parent, this is a constrained drill down.
37990>>>                Case Break
37991>>>
37991>>>            Case (NavigateData.eNavigateType = nfFromChild)
37994>>>                // If from child, this is a probably a parent Zoom from a Zoom.
37994>>>                Case Break
37995>>>
37995>>>            Case Else // must be nfUndefined
37995>>>
37995>>>        Case End
37995>>>
37995>>>        Send SetActionButtons
37996>>>
37996>>>    End_Procedure
37997>>>
37997>>>End_Object 
37998>    Use SelectStudent.wo
Including file: SelectStudent.wo    (C:\DataFlex Projects\ColegioAppWeb\AppSrc\SelectStudent.wo)
37998>>>// C:\DataFlex Projects\ColegioAppWeb\AppSrc\SelectStudent.wo
37998>>>// SelectStudent
37998>>>//
37998>>>
37998>>>Use cWebView.pkg
37998>>>Use cWebList.pkg
37998>>>Use cWebMenuGroup.pkg
37998>>>Use cWebMenuItem.pkg
37998>>>Use cWebColumnButton.pkg
37998>>>Use cWebColumn.pkg
37998>>>Use Student.wo
37998>>>
37998>>>Use cschoolhouseDataDictionary.dd
37998>>>Use cstudentDataDictionary.dd
37998>>>
37998>>>Object oSelectStudent is a cWebView
38000>>>    Set psCaption to "ALUMNOS"
38001>>>    Set peWebViewStyle to wvsDrilldown
38002>>>    Set peViewType to vtSelect
38003>>>    Set piColumnCount to 12
38004>>>    Set pbShowCaption to True
38005>>>    Set piMaxWidth to 1024
38006>>>
38006>>>    Object oschoolhouse_DD is a cschoolhouseDataDictionary
38008>>>    End_Object 
38009>>>
38009>>>    Object ostudent_DD is a cstudentDataDictionary
38011>>>        Set DDO_Server To oschoolhouse_DD
38012>>>    End_Object 
38013>>>
38013>>>    Set Main_DD To ostudent_DD
38014>>>    Set Server  To ostudent_DD
38015>>>
38015>>>
38015>>>    Object oList is a cWebList
38017>>>        Set piColumnSpan to 12
38018>>>        Set psCSSClass to "MobileList"
38019>>>        Set pbServerOnRowClick to True
38020>>>        Set pbFillHeight to True
38021>>>        Set pbShowHeader to False
38022>>>        Set piSortColumn to 0
38023>>>
38023>>>        /*Object ostudentID is a cWebColumn            Entry_Item student.ID            Set psCaption to "student.ID"            Set piWidth to 124        End_Object*/
38023>>>
38023>>>        Object oDetailButton is a cWebColumnButton
38025>>>            Set psCaption to "btn"
38026>>>            Set piWidth to 45
38027>>>            Set pbFixedWidth to True
38028>>>            Set pbResizable to False
38029>>>            Set piListRowSpan to 8
38030>>>            Set psBtnCssClass to "WebButtonIcon WebIcon_Info"
38031>>>            Set peAlign to alignRight
38032>>>            Set pbShowCaption to False
38033>>>            Set pbHidden to True
38034>>>
38034>>>            WebRegisterPath ntNavigateForward oStudent
38040>>>
38040>>>            Procedure OnClick
38043>>>                Send NavigatePath
38044>>>            End_Procedure
38045>>>
38045>>>            Procedure OnGetNavigateForwardData tWebNavigateData ByRef NavigateData Handle hoToView
38048>>>                Move True to NavigateData.bReadOnly
38049>>>            End_Procedure
38050>>>
38050>>>        End_Object 
38051>>>
38051>>>        Object ostudentName is a cWebColumn
38053>>>            Entry_Item student.Name
38054>>>            Set psCaption to "student.Name"
38055>>>            Set piWidth to 192
38056>>>        End_Object 
38057>>>
38057>>>        Object ostudentLastName is a cWebColumn
38059>>>            Entry_Item student.LastName
38060>>>            Set psCaption to "student.LastName"
38061>>>            Set piWidth to 282
38062>>>        End_Object 
38063>>>
38063>>>        Object ostudentDNI is a cWebColumn
38065>>>            Entry_Item student.DNI
38066>>>            Set psCaption to "student.DNI"
38067>>>            Set piWidth to 205
38068>>>        End_Object 
38069>>>
38069>>>        Object ostudentEmail is a cWebColumn
38071>>>            Entry_Item student.Email
38072>>>            Set psCaption to "student.Email"
38073>>>            Set piWidth to 319
38074>>>        End_Object 
38075>>>
38075>>>        /*Object oschoolhouseID is a cWebColumn            Entry_Item schoolhouse.ID            Set psCaption to "schoolhouse.ID"            Set piWidth to 124            Set pbNewLine to True        End_Object*/ 
38075>>>
38075>>>        Object oschoolhouseName is a cWebColumn
38077>>>            Entry_Item schoolhouse.Name
38078>>>            Set psCaption to "schoolhouse.Name"
38079>>>            Set piWidth to 2243
38080>>>            Set pbNewLine to True
38081>>>        End_Object 
38082>>>
38082>>>        Object oschoolhouseEmail is a cWebColumn
38084>>>            Entry_Item schoolhouse.Email
38085>>>            Set psCaption to "schoolhouse.Email"
38086>>>            Set piWidth to 2182
38087>>>        End_Object 
38088>>>
38088>>>        WebRegisterPath ntNavigateForward oStudent
38094>>>
38094>>>        Procedure OnRowClick String sRowId
38097>>>            tWebNavigateData NavigateData
38097>>>            tWebNavigateData NavigateData
38097>>>            Get GetNavigateData to NavigateData
38098>>>
38098>>>            Case Begin
38098>>>                Case (NavigateData.eNavigateType = nfFromParent)
38100>>>                    Send NavigateForward of oStudent Self
38101>>>                    Case Break
38102>>>
38102>>>                Case (NavigateData.eNavigateType = nfFromChild)
38105>>>                    Send NavigateClose Self
38106>>>                    Case Break
38107>>>
38107>>>                Case (NavigateData.eNavigateType = nfFromMain)
38110>>>                    Send NavigateClose Self
38111>>>                    Case Break
38112>>>
38112>>>                Case Else // must be nfUndefined
38112>>>                    Send NavigateForward of oStudent Self
38113>>>
38113>>>            Case End
38113>>>        End_Procedure
38114>>>
38114>>>        Procedure OnGetNavigateForwardData tWebNavigateData ByRef NavigateData Handle hoToView
38117>>>            Move True to NavigateData.bReadOnly
38118>>>        End_Procedure
38119>>>
38119>>>    End_Object 
38120>>>
38120>>>    Object oActionGroup is a cWebMenuGroup
38122>>>
38122>>>        Object oSearch is a cWebMenuItem
38124>>>            Set psCSSClass to "WebPromptMenuItem"
38125>>>            Set psCaption to "Buscar"
38126>>>
38126>>>            Procedure OnClick
38129>>>                Send Search of oList
38130>>>            End_Procedure
38131>>>
38131>>>        End_Object 
38132>>>
38132>>>        Object oNewButton is a cWebMenuItem
38134>>>            Set psCSSClass to "WebClearMenuItem"
38135>>>            Set psCaption to "Nuevo"
38136>>>
38136>>>            WebRegisterPath ntNavigateForward oStudent
38142>>>
38142>>>            Procedure OnClick
38145>>>                Send NavigatePath
38146>>>            End_Procedure
38147>>>
38147>>>            Procedure OnGetNavigateForwardData tWebNavigateData ByRef NavigateData Handle hoToView
38150>>>                Move True to NavigateData.bNewRecord
38151>>>            End_Procedure
38152>>>
38152>>>        End_Object 
38153>>>    End_Object 
38154>>>
38154>>>    Procedure OnNavigateForward tWebNavigateData NavigateData Integer hoInvokingView Integer hoInvokingObject
38157>>>        WebSet pbRender of oNewButton to True
38158>>>        WebSet pbRender of oDetailButton to True
38159>>>
38159>>>        Case Begin
38159>>>            Case (NavigateData.eNavigateType = nfFromParent)
38161>>>                // If from parent, this is a constrained drill down
38161>>>                // If Row select does main-zoom we don't need this
38161>>>                WebSet pbRender of oDetailButton to False
38162>>>                Case Break
38163>>>
38163>>>            Case (NavigateData.eNavigateType = nfFromChild)
38166>>>                // If from child, this is a probably a parent lookup from a Zoom
38166>>>                Case Break
38167>>>
38167>>>            Case (NavigateData.eNavigateType = nfFromMain)
38170>>>                // If from main, this is a probably a main-file lookup from a Zoom
38170>>>                WebSet pbRender of oDetailButton to False
38171>>>                Case Break
38172>>>
38172>>>            Case Else // must be nfUndefined
38172>>>                // This may be the start of a drilldown query or this may be used for some kind of custom query.
38172>>>                // If Row select does main-zoom we don't need this
38172>>>                WebSet pbRender of oDetailButton to False
38173>>>
38173>>>        Case End
38173>>>
38173>>>    End_Procedure
38174>>>
38174>>>
38174>>>End_Object 
38175>    Use CheckStatus.wo
Including file: CheckStatus.wo    (C:\DataFlex Projects\ColegioAppWeb\AppSrc\CheckStatus.wo)
38175>>>Use cWebHttpHandler.pkg
38175>>>
38175>>>//  With the cWebHttpHandler you handle complete HTTP requests.
38175>>>Object oCheckStatus is a cWebHttpHandler
38177>>>    
38177>>>    //  The psPath property determines the path in the URL for which requests will be handled.
38177>>>    Set psPath to "CheckMyStatus"
38178>>>    //  Use psVerbs to filter based on the HTTP Verbs. 
38178>>>    Set psVerbs to "GET"
38179>>>
38179>>>    Procedure OnHttpGet String sPath String sAcceptType
38182>>>        Forward Send OnHttpGet sPath sAcceptType
38184>>>        Handle hoJsonResponse
38184>>>        UChar[] ucData
38185>>>        
38185>>>        Get Create (RefClass(cJsonObject)) to hoJsonResponse
38186>>>        Send InitializeJsonType of hoJsonResponse jsonTypeObject
38187>>>        
38187>>>        Send SetMemberValue of hoJsonResponse "Status" jsonTypeString "Activo"
38188>>>        Send SetMemberValue of hoJsonResponse "Fecha y hora Actual" jsonTypeString "Current_DateTime"
38189>>>        
38189>>>        Send AddHttpResponseHeader of hoJsonResponse "Content-Type" "application/json"
38190>>>        
38190>>>        Get StringifyUtf8 of hoJsonResponse to ucData
38191>>>        
38191>>>        Send Destroy of hoJsonResponse
38192>>>        Send OutputUChar ucData
38193>>>        
38193>>>    End_Procedure    
38194>>>End_Object
38195>    Set phoDefaultView to oDashboard
38196>
38196>End_Object
38197>
38197>Send StartWebApp of oWebApp
38198>
Summary
Memory Available: 15988445184
Total Warnings : 0
Total Errors   : 0
Total Symbols  : 25390
Total Resources: 0
Total Commands : 38197
Total Windows  : 0
Total Pages    : 0
Static Data    : 470431
Message area   : 255201
Total Blocks   : 16987
